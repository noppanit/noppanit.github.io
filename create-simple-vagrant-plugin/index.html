<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>How to create a simple vagrant plugin.</title>
  <meta name="description" content="I have been searching all over the Internet to find how to create a vagrant plugin. Vagrant homepage has information on how to create a vagrant plugin, but I...">

  
  
  <link rel="stylesheet" href="http://localhost:4000/assets/style.css">

  <link rel="canonical" href="http://localhost:4000/create-simple-vagrant-plugin/">
  <link rel="alternate" type="application/rss+xml" title="Noppanit" href="http://localhost:4000/feed.xml">

  <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>

  
  <!-- font-smoothing is only applied on dark themes -->
  <body class="font-smoothing">

    <header class="px-2 clearfix">
  <!-- <div class="left-lg absolute-lg left-0 top-0 sm-width-full mt-2">
    <a class="no-underline-hover px-1" href="/">
      <span class="inline-block h4 hide-sm ml-2">&#x261c;</span>
    </a>
    <a class="italic no-underline" href="/">
       home
    </a>
  </div> -->
  <div class="right-lg absolute-lg right-0 top-0">
    <ul class="mt-1 mt-lg-2 mr-2 mr-lg-3">
      <li class="inline-block block-lg text-right ml-1 ml-lg-0">
        <a class="italic h4 bold no-underline" href="/">
          <!-- Noppanit -->
          Home
        </a>
      </li>
      
        
      
        
      
        
      
        
      
    </ul>
  </div>
</header>


    <div>
      <article class="container mx-auto px-2" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="mt-4 mb-2 clearfix header-text">
    <h1 class="h0 inline-block py-2 mt-4 header-title">How to create a simple vagrant plugin.</h1>
    <div class="clearfix mb-4 py-1">
      <p class="h4 lh-condensed"><time datetime="2014-11-21T00:00:00-05:00" itemprop="datePublished">Nov 21, 2014</time></p>
      <div class="col-1 sm-width-full border-top-thick">
      </div>
    </div>
  </div>

  <div class="prose py-4" itemprop="articleBody">
      <p>I have been searching all over the Internet to find how to create a vagrant plugin. <a href="https://docs.vagrantup.com/v2/plugins/index.html" title="vagrant plugin">Vagrant homepage</a> has information on how to create a vagrant plugin, but I would like to give a real world example. The plugin I’m going to create is <strong><a href="https://github.com/noppanit/vagrant-ls" title="vagrant-ls">vagrant-ls</a></strong> which is inspired by <strong><a href="https://github.com/joshmcarthur/vagrant-list" title="vagrant-list">vagrant-list</a></strong>.</p>

<h2 id="how-do-you-start">How do you start</h2>

<p>Vagrant that you installed already won’t work with local developing plugin. So, I recommend you to create a new gemset for your plugin. If you haven’t used <a href="http://rvm.io/" title="rvm">RVM</a>, I highly recommend you use it now. It’s awesome!.</p>

<p>Once you have RVM installed you can create a gemset using this command <strong>rvm gemset create vagrant-ls</strong>. Then <strong>rvm gemset use vagrant-ls</strong> (Just in case). I recommend you do this for each of your ruby project. It helps you separate your gems, and it won’t mess up with different versions of your gems. First thing that you have to install is Bundler <strong>gem install bundler</strong>. It’s because we will use Bundler to manage all of our dependencies. Then you can create <strong>Gemfile</strong>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">source</span> <span class="s2">"https://rubygems.org"</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s2">"vagrant"</span><span class="p">,</span> <span class="ss">git: </span><span class="s2">"https://github.com/mitchellh/vagrant.git"</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:plugins</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s2">"vagrant-ls"</span><span class="p">,</span> <span class="ss">path: </span><span class="s2">"."</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This is the most basic you would need for your plugin development. If you wonder what is <em>group :plugins</em>
. <a href="https://docs.vagrantup.com/v2/plugins/development-basics.html">Vagrant plugin</a> has already explained that. This will load your local plugin automatically without doing <em>bundle exec vagrant install plugin vagrant-ls</em> which will not quite work anyway.</p>

<p>Then you can create your gemspec file. I name it <strong>vagrant-ls.gemspec</strong></p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s1">'../lib/vagrant-ls/version'</span><span class="p">,</span> <span class="kp">__FILE__</span><span class="p">)</span>

<span class="no">Gem</span><span class="o">::</span><span class="no">Specification</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">name</span>            <span class="o">=</span> <span class="s1">'vagrant-ls'</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">version</span>         <span class="o">=</span> <span class="no">Vagrant</span><span class="o">::</span><span class="no">Ls</span><span class="o">::</span><span class="no">VERSION</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">date</span>            <span class="o">=</span> <span class="s1">'2014-11-18'</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">summary</span>         <span class="o">=</span> <span class="s2">"List all vms"</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">description</span>     <span class="o">=</span> <span class="s2">"A simple vagrant plugin for listing all vms"</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">authors</span>         <span class="o">=</span> <span class="p">[</span><span class="s2">"Noppanit Charassinvichai"</span><span class="p">]</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">email</span>           <span class="o">=</span> <span class="s1">'noppanit.c@gmail.com'</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">files</span>           <span class="o">=</span> <span class="sb">`git ls-files`</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="vg">$\</span><span class="p">)</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">executables</span>     <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">files</span><span class="p">.</span><span class="nf">grep</span><span class="p">(</span><span class="sr">%r{^bin/}</span><span class="p">).</span><span class="nf">map</span><span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="no">File</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">require_paths</span>   <span class="o">=</span> <span class="p">[</span><span class="s1">'lib'</span><span class="p">]</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">homepage</span>        <span class="o">=</span> <span class="s1">'https://github.com/noppanit/vagrant-ls'</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">license</span>         <span class="o">=</span> <span class="s1">'GNU'</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Then you crate <strong>Rakefile</strong></p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'rubygems'</span>
<span class="nb">require</span> <span class="s1">'bundler/setup'</span>
<span class="no">Bundler</span><span class="o">::</span><span class="no">GemHelper</span><span class="p">.</span><span class="nf">install_tasks</span>
</code></pre></div></div>

<p>Then you move on to create your plugin using this <a href="http://guides.rubygems.org/patterns/" title="gem pattern">pattern</a>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># lib/vagrant-ls.rb</span>
<span class="nb">require</span> <span class="s1">'bundler'</span>

<span class="k">begin</span>
  <span class="nb">require</span> <span class="s1">'vagrant'</span>
<span class="k">rescue</span> <span class="no">LoadError</span>
  <span class="no">Bundler</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:default</span><span class="p">,</span> <span class="ss">:development</span><span class="p">)</span>
<span class="k">end</span>

<span class="nb">require</span> <span class="s1">'vagrant-ls/plugin'</span>
<span class="nb">require</span> <span class="s1">'vagrant-ls/command'</span>
</code></pre></div></div>

<p>I almost forget you need to create VERSION file for gemspec to get your version number</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># lib/vagrant-ls/version.rb</span>
<span class="k">module</span> <span class="nn">Vagrant</span>
    <span class="k">module</span> <span class="nn">Ls</span>
        <span class="no">VERSION</span> <span class="o">=</span> <span class="s1">'0.0.1'</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>
<p>Then you create your plugin class, this will be the place where vagrant finds information about your plugin.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># lib/vagrant-ls/plugin.rb</span>
<span class="k">module</span> <span class="nn">Vagrant</span>

    <span class="k">module</span> <span class="nn">Ls</span>

        <span class="k">class</span> <span class="nc">Plugin</span> <span class="o">&lt;</span> <span class="no">Vagrant</span><span class="p">.</span><span class="nf">plugin</span><span class="p">(</span><span class="s1">'2'</span><span class="p">)</span>
          <span class="nb">name</span> <span class="s2">"List"</span>

          <span class="n">description</span> <span class="o">&lt;&lt;-</span><span class="no">DESC</span><span class="sh">
          This plugin 'ls' all of the vms running inside the machine
</span><span class="no">          DESC</span>

          <span class="n">command</span> <span class="s1">'ls'</span> <span class="k">do</span>
            <span class="nb">require_relative</span> <span class="s1">'command'</span>
            <span class="no">Command</span>
          <span class="k">end</span>

        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This is where you will name your command.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">command</span> <span class="s1">'ls'</span> <span class="k">do</span>
<span class="o">...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Last one, this is where vagrant will know how to execute your plugin</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># lib/vagrant-ls/command.rb</span>
<span class="k">module</span> <span class="nn">Vagrant</span>
    <span class="k">module</span> <span class="nn">Ls</span>
        <span class="k">class</span> <span class="nc">Command</span> <span class="o">&lt;</span> <span class="no">Vagrant</span><span class="p">.</span><span class="nf">plugin</span><span class="p">(</span><span class="s1">'2'</span><span class="p">,</span> <span class="ss">:command</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">execute</span>
                <span class="nb">exec</span><span class="p">(</span><span class="s1">'VBoxManage list vms'</span><span class="p">)</span>
                <span class="mi">0</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>

<span class="k">end</span>
</code></pre></div></div>

<p>I just run <strong>VBoxManage</strong> command to list all of the vms. Once you are done, you are ready to test your plugin.</p>

<p>You can run this command</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle <span class="nb">exec </span>vagrant <span class="nb">ls</span>
</code></pre></div></div>

<p>. If everything is correct, it should list all of your vms with the name of your vms, so you know where you are you running all those vms.</p>

<h2 id="publish-your-gem">Publish your gem</h2>

<p>Now, it’s time to spread the love of your gem. You need to build your gem first. Remember the Rakefile? You can just run <em>rake build</em></p>

<p>It will pack your gem to <strong>.pkg</strong> folder. Then you can just run</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem push pkg/vagrant-ls-0.0.1.gem
</code></pre></div></div>

<p>. That’s it you have your gem published. If you look for <a href="http://guides.rubygems.org/publishing/">documentation</a> for publishing your gem.</p>

<p>You can find my repository <a href="https://github.com/noppanit/vagrant-ls">here</a>. The reason I create this post is that, the plugin might evolve but this blog stays and it will be a good starting point for other people.</p>


  </div>
</article>

<div class="container mx-auto px-2 py-2 clearfix">
  <!-- Use if you want to show previous and next for all posts. -->



  <div class="col-4 sm-width-full left mr-lg-4 mt-3">
    <a class="no-underline-hover py-1 block" href="http://localhost:4000/twitter-good-tool-customer-support-used-carefully/">
      <span class="h5 bold">Previous</span>
      <p class="bold h3 link-primary mb-1">Twitter is a good tool for customer support if used carefully.</p>
      <p>I recently moved to NYC and I just got a pre-paid T-Mobile just to try it out how it goes....</p>
    </a>
  </div>
  
  
  <div class="col-4 sm-width-full left mt-3">
    <a class="no-underline-hover py-1 block" href="http://localhost:4000/event-delegation-javascript-fast-fast/">
      <span class="h5 bold">Next</span>
      <p class="bold h3 link-primary mb-1">Event delegation in JavaScript is fast but how fast?</p>
      <p>People say always use event delegation for adding event because it&#8217;s faster. But how fast exactly? I really want to...</p>
    </a>
  </div>


</div>

    </div>

    <div class="container mx-auto clearfix mt-2 mt-lg-4 px-2">
  <div class="border-top-thick">
    <p class="col-8 sm-width-full left py-2 mb-0">This project is maintained by <a class="text-accent" href="https://github.com/noppanit">noppanit</a></p>
    <ul class="list-reset right clearfix sm-width-full py-2 mb-2 mb-lg-0">
      <li class="inline-block mr-1">
        <a href="https://twitter.com/share" class="twitter-share-button" data-hashtags="Noppanit">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      </li>
      <li class="inline-block">
        <a class="github-button" href="https://github.com/noppanit/" data-icon="octicon-star" data-count-href="noppanit//stargazers" data-count-api="/repos/noppanit/#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star noppanit/ on GitHub">Star</a>
      </li>
    </ul>
  </div>
</div>


  </body>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

</html>