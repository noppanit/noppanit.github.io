
<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>How to create a simple vagrant plugin.</title>
  <meta name="description" content="I have been searching all over the Internet to find how to create a vagrant plugin. Vagrant homepage has information on how to create a vagrant plugin, but I...">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/create-simple-vagrant-plugin/">
  <link rel="alternate" type="application/rss+xml" title="Noppanit" href="/feed.xml">
  
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">Noppanit</a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">How to create a simple vagrant plugin.</h1>
    <p class="post-meta">
      <time datetime="2014-11-21T00:00:00-05:00" itemprop="datePublished">
        
        Nov 21, 2014
      </time>
      
        • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Noppanit Charassinvichai</span></span>
      </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>I have been searching all over the Internet to find how to create a vagrant plugin. <a href="https://docs.vagrantup.com/v2/plugins/index.html" title="vagrant plugin">Vagrant homepage</a> has information on how to create a vagrant plugin, but I would like to give a real world example. The plugin I’m going to create is <strong><a href="https://github.com/noppanit/vagrant-ls" title="vagrant-ls">vagrant-ls</a></strong> which is inspired by <strong><a href="https://github.com/joshmcarthur/vagrant-list" title="vagrant-list">vagrant-list</a></strong>.</p>

<h2 id="how-do-you-start">How do you start</h2>

<p>Vagrant that you installed already won’t work with local developing plugin. So, I recommend you to create a new gemset for your plugin. If you haven’t used <a href="http://rvm.io/" title="rvm">RVM</a>, I highly recommend you use it now. It’s awesome!.</p>

<p>Once you have RVM installed you can create a gemset using this command <strong>rvm gemset create vagrant-ls</strong>. Then <strong>rvm gemset use vagrant-ls</strong> (Just in case). I recommend you do this for each of your ruby project. It helps you separate your gems, and it won’t mess up with different versions of your gems. First thing that you have to install is Bundler <strong>gem install bundler</strong>. It’s because we will use Bundler to manage all of our dependencies. Then you can create <strong>Gemfile</strong>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">source</span> <span class="s2">"https://rubygems.org"</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s2">"vagrant"</span><span class="p">,</span> <span class="ss">git: </span><span class="s2">"https://github.com/mitchellh/vagrant.git"</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:plugins</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s2">"vagrant-ls"</span><span class="p">,</span> <span class="ss">path: </span><span class="s2">"."</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This is the most basic you would need for your plugin development. If you wonder what is <em>group :plugins</em>
. <a href="https://docs.vagrantup.com/v2/plugins/development-basics.html">Vagrant plugin</a> has already explained that. This will load your local plugin automatically without doing <em>bundle exec vagrant install plugin vagrant-ls</em> which will not quite work anyway.</p>

<p>Then you can create your gemspec file. I name it <strong>vagrant-ls.gemspec</strong></p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s1">'../lib/vagrant-ls/version'</span><span class="p">,</span> <span class="kp">__FILE__</span><span class="p">)</span>

<span class="no">Gem</span><span class="o">::</span><span class="no">Specification</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">name</span>            <span class="o">=</span> <span class="s1">'vagrant-ls'</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">version</span>         <span class="o">=</span> <span class="no">Vagrant</span><span class="o">::</span><span class="no">Ls</span><span class="o">::</span><span class="no">VERSION</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">date</span>            <span class="o">=</span> <span class="s1">'2014-11-18'</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">summary</span>         <span class="o">=</span> <span class="s2">"List all vms"</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">description</span>     <span class="o">=</span> <span class="s2">"A simple vagrant plugin for listing all vms"</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">authors</span>         <span class="o">=</span> <span class="p">[</span><span class="s2">"Noppanit Charassinvichai"</span><span class="p">]</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">email</span>           <span class="o">=</span> <span class="s1">'noppanit.c@gmail.com'</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">files</span>           <span class="o">=</span> <span class="sb">`git ls-files`</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="vg">$\</span><span class="p">)</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">executables</span>     <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">files</span><span class="p">.</span><span class="nf">grep</span><span class="p">(</span><span class="sr">%r{^bin/}</span><span class="p">).</span><span class="nf">map</span><span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="no">File</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">require_paths</span>   <span class="o">=</span> <span class="p">[</span><span class="s1">'lib'</span><span class="p">]</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">homepage</span>        <span class="o">=</span> <span class="s1">'https://github.com/noppanit/vagrant-ls'</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">license</span>         <span class="o">=</span> <span class="s1">'GNU'</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Then you crate <strong>Rakefile</strong></p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'rubygems'</span>
<span class="nb">require</span> <span class="s1">'bundler/setup'</span>
<span class="no">Bundler</span><span class="o">::</span><span class="no">GemHelper</span><span class="p">.</span><span class="nf">install_tasks</span>
</code></pre></div></div>

<p>Then you move on to create your plugin using this <a href="http://guides.rubygems.org/patterns/" title="gem pattern">pattern</a>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># lib/vagrant-ls.rb</span>
<span class="nb">require</span> <span class="s1">'bundler'</span>

<span class="k">begin</span>
  <span class="nb">require</span> <span class="s1">'vagrant'</span>
<span class="k">rescue</span> <span class="no">LoadError</span>
  <span class="no">Bundler</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:default</span><span class="p">,</span> <span class="ss">:development</span><span class="p">)</span>
<span class="k">end</span>

<span class="nb">require</span> <span class="s1">'vagrant-ls/plugin'</span>
<span class="nb">require</span> <span class="s1">'vagrant-ls/command'</span>
</code></pre></div></div>

<p>I almost forget you need to create VERSION file for gemspec to get your version number</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># lib/vagrant-ls/version.rb</span>
<span class="k">module</span> <span class="nn">Vagrant</span>
    <span class="k">module</span> <span class="nn">Ls</span>
        <span class="no">VERSION</span> <span class="o">=</span> <span class="s1">'0.0.1'</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>
<p>Then you create your plugin class, this will be the place where vagrant finds information about your plugin.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># lib/vagrant-ls/plugin.rb</span>
<span class="k">module</span> <span class="nn">Vagrant</span>

    <span class="k">module</span> <span class="nn">Ls</span>

        <span class="k">class</span> <span class="nc">Plugin</span> <span class="o">&lt;</span> <span class="no">Vagrant</span><span class="p">.</span><span class="nf">plugin</span><span class="p">(</span><span class="s1">'2'</span><span class="p">)</span>
          <span class="nb">name</span> <span class="s2">"List"</span>

          <span class="n">description</span> <span class="o">&lt;&lt;-</span><span class="no">DESC</span><span class="sh">
          This plugin 'ls' all of the vms running inside the machine
</span><span class="no">          DESC</span>

          <span class="n">command</span> <span class="s1">'ls'</span> <span class="k">do</span>
            <span class="nb">require_relative</span> <span class="s1">'command'</span>
            <span class="no">Command</span>
          <span class="k">end</span>

        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This is where you will name your command.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">command</span> <span class="s1">'ls'</span> <span class="k">do</span>
<span class="o">...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Last one, this is where vagrant will know how to execute your plugin</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># lib/vagrant-ls/command.rb</span>
<span class="k">module</span> <span class="nn">Vagrant</span>
    <span class="k">module</span> <span class="nn">Ls</span>
        <span class="k">class</span> <span class="nc">Command</span> <span class="o">&lt;</span> <span class="no">Vagrant</span><span class="p">.</span><span class="nf">plugin</span><span class="p">(</span><span class="s1">'2'</span><span class="p">,</span> <span class="ss">:command</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">execute</span>
                <span class="nb">exec</span><span class="p">(</span><span class="s1">'VBoxManage list vms'</span><span class="p">)</span>
                <span class="mi">0</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>

<span class="k">end</span>
</code></pre></div></div>

<p>I just run <strong>VBoxManage</strong> command to list all of the vms. Once you are done, you are ready to test your plugin.</p>

<p>You can run this command</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle <span class="nb">exec </span>vagrant <span class="nb">ls</span>
</code></pre></div></div>

<p>. If everything is correct, it should list all of your vms with the name of your vms, so you know where you are you running all those vms.</p>

<h2 id="publish-your-gem">Publish your gem</h2>

<p>Now, it’s time to spread the love of your gem. You need to build your gem first. Remember the Rakefile? You can just run <em>rake build</em></p>

<p>It will pack your gem to <strong>.pkg</strong> folder. Then you can just run</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem push pkg/vagrant-ls-0.0.1.gem
</code></pre></div></div>

<p>. That’s it you have your gem published. If you look for <a href="http://guides.rubygems.org/publishing/">documentation</a> for publishing your gem.</p>

<p>You can find my repository <a href="https://github.com/noppanit/vagrant-ls">here</a>. The reason I create this post is that, the plugin might evolve but this blog stays and it will be a good starting point for other people.</p>


  </div>

  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Noppanit</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              Noppanit
            
            </li>
            
            <li><a href="mailto:hi@noppanit.com">hi@noppanit.com</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/noppanit"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">noppanit</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/noppanit"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">noppanit</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>My personal adventure</p>
      </div>
    </div>

  </div>

</footer>


  </body>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

</html>