
<!doctype>
<html lang="en">
  <head>
    <meta content='Maps all parking signs in NYC. - Noppanit' name='title' />
    <meta content='Maps all parking signs in NYC. - Noppanit' name='og:title' />
    <title>Maps all parking signs in NYC. - Noppanit</title>
    <link href='https://www.noppanit.com/images/fav.png' rel='shortcut icon'>
<link href='https://www.noppanit.com/stylesheets/style.css' rel='stylesheet' type='text/css' />
<link href='https://www.noppanit.com/stylesheets/syntax.css' rel='stylesheet' type='text/css' />

<meta content='width=device-width, initial-scale=1.0, user-scalable=no' name='viewport'>
<meta content='text/html; charset=utf-8' http-equiv='content-type' />

  <meta content='https://www.noppanit.com/posts/maps-all-parking-signs-in-nyc' property='og:url' />
  <meta content="This post might be too easy for any Data-viz people but as a beginner tapping in this area. It took me quite a long t..." property='og:description' />
  <meta content="article" property="og:type" />

<!-- - -->





  </head>
  <body class="lh-copy dark-gray pa0 f6 sans-serif bg-super-white">
    <header class="tc mt4">
      <a href="https://www.noppanit.com">
        <img src="https://www.noppanit.com/images/scribble.png" alt="Home" width="53" height="59">
      </a>
      <p>Noppanit</p>
    </header>
    <div class="mw7 bg-white mt4 mb3 center br2-ns bt bb ba-ns b--light-gray">
      <nav class="bb b--light-gray pv4 tc" aria-label="Main">
        
      </nav>

      <main class="tl f6 relative pa4 pa5-ns overflow-hidden">
        
          <div class="mb4">
            <div class="fw600 light-silver mt1">30 Jul 2015</div>
            <h1 class="ttu f3 mt0 lh-title cb mb2">
              
              Maps all parking signs in NYC.
            </h1>
            
          </div>
        
        <div class="markdown-body">
          <p>This post might be too easy for any Data-viz people but as a beginner tapping in this area. It took me quite a long time to figure it out so I just want to share this hoping that it might save people’s time.</p>

<p>Parking in NYC is really a pain, especially street parking where there’re lots of signs and regulations. There are some apps on Android and iPhone that you can download and see signs but I haven’t been able to find the one that suits my needs. I want an application that can tell me where to circle arounds on which day and time to find parking spot. For example, I parked my car on a Tuesday which has street cleaning on Wednesday and Friday from 8:30 to 9:30. That means I have to move the car on Wednesday morning to find a spot for Friday. The problem is I don’t know what’s around me. The closest application I find is <a href="http://www.nycparklife.com/streetparker/">http://www.nycparklife.com/streetparker/</a> which it doesn’t have Manhattan.</p>

<h2 id="getting-the-data">Getting the data</h2>

<p>So, I googled and thank NYC.gov that provides the <a href="http://www.nyc.gov/html/dot/html/about/datafeeds.shtml#parking">data</a> for us. First, I played around with the csv files but they don’t have coordinates that I can place location on the map. And I have no experience dealing with shapefiles.</p>

<h2 id="extracting-the-data">Extracting the data</h2>

<p>After a few hours of mangling and munching the csv with Pandas and R. I would not be able to get the exact locations of all the signs. So I turned to shapefile hoping that I might get lucky. And I found this <a href="http://www.shpescape.com/">http://www.shpescape.com/</a> which promised to transform shapefile to <a href="https://support.google.com/fusiontables/answer/2571232?hl=en">Google Fusion Table</a>. Awesome! I went ahead and tried it. It works great! but it only gives you the first 100,000 rows. So dug deeper. After another few hours of googling I found <a href="http://www.qgis.org/en/site/">qGis</a> which is a opensource project that you can use to open and view shapefile.</p>

<p>Here’s the example.</p>

<p><img src="/wp-content/uploads/2015/07/Screenshot-2015-07-30-12.52.32.jpg" alt="Parking signs on Qgis" /></p>

<p>One thing I learnt was that you cannot just click <strong>Open</strong> and choose the file. What you need to do is to <string>Add Vector Layer&lt;/strong&gt;. You can use shortcut **Ctrl+Shift+v**</string></p>

<p><img src="/wp-content/uploads/2015/07/Screenshot-2015-07-30-12.55.56.jpg" alt="Add Vector Layer" /></p>

<h2 id="export-to-google-fusion">Export to Google Fusion</h2>

<p>Now what we need is to import what we have to Google Fusion Table. How are we going to turn this beautiful layer to Google Maps. We need CSV…</p>

<p>In QGis you can download the file as CSV. It’s in <strong>Layer &gt; Save As</strong>. You just need to make sure that <strong>Geometry</strong> has to be set so you get the coordinates.</p>

<p><img src="/wp-content/uploads/2015/07/Screenshot-2015-07-30-13.02.06.jpg" alt="Save to CSV" /></p>

<h2 id="import-to-google-fusion-table">Import to Google Fusion Table</h2>

<p>Now we can use that CSV to import to Google Fusion. It would look something like this.</p>

<p><img src="/wp-content/uploads/2015/07/Screenshot-2015-07-30-13.04.35.jpg" alt="Google Fusion Table" /></p>

<p>what you need to make sure is that you need to specify which fields are Lat, Long so Google can plot that for you.</p>

<p>Here’s how you do it.</p>

<p><img src="/wp-content/uploads/2015/07/Screenshot-2015-07-30-13.05.41.jpg" /></p>

<p>The click <strong>change</strong> You will see something like this and you can choose which field you want to be Longitude or Latitude.</p>

<p><img src="/wp-content/uploads/2015/07/Screenshot-2015-07-30-13.06.33.jpg" alt="Set Location" /></p>

<p>Once the coordinates have set we can go to Map tab and see beautiful little dots that show where all the signs are in NYC.</p>

<p><img src="/wp-content/uploads/2015/07/Screenshot-2015-07-30-13.07.47.jpg" alt="Parking signs in Google Fusion Table" /></p>

<p>Walla! Now you have something you can build an application on top of it. The next post, I will create an application on top of this map to make use of our data.</p>

<h2 id="things-i-have-tried-and-failed">Things I have tried and failed</h2>

<p>I’ve tried using <a href="https://github.com/OSGeo/proj.4">Proj4</a> on both R and Python to convert X,Y WGS84 to Lat, Long. Here’s my little snippet.</p>

<pre><code class="language-plain">
data = read.csv('./parking_regulation.csv')

library(proj4)
proj4string &lt;- "+proj=lcc +lat_1=40.66666666666666 +lat_2=41.03333333333333 +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs"
latlong_list&lt;-list()
calculate_long_lat &lt;- function(x,y) {
  
  # Source data
  xy &lt;- data.frame(x=x, y=y)
  
  # Transformed data
  pj &lt;- project(xy, proj4string, inverse=TRUE)
  latlon &lt;- data.frame(lat=pj$y, lon=pj$x)
  latlong_list[['latlong']] &lt;- latlon
}

apply(data[,c('x','y')], 1, function(y) calculate_long_lat(y['x'], y['y']))

</code></pre>

<p>The result is not quite accurate which I think it’s because I need to find a correct <strong>proj4string</strong>.</p>

<p>Python has the same wrapper which is quite what I want as well.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">python</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line">from pyproj import Proj
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">import pandas as pd
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">data = pd.read_csv('parking_regulation.csv')
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">p = Proj(r'+proj=lcc +lat_1=40.66666666666666 +lat_2=41.03333333333333 +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs')
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">def cal_long_lat(row):
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">    return p(row['x'], row['y'],inverse=True)
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">data['lon'], data['lat'] = zip(data.apply (lambda row: cal_long_lat (row),axis=1))
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">data.head()</div></div></pre></div></figure>

<p>I will need to learn more about State Pane and what is the correct format.</p>

<p>This article takes 2 pomodoros to complete.</p>


        </div>
        <p class="mt4">
  Til next time,<br>
  noppanit
  <span class="silver">at 00:00</span>
</p>
<img src="https://www.noppanit.com/images/scribble3.png" alt="scribble" />

      </main>
      <section class="fixed-l mw7 center w-100 top-50 tc pb4 nt4">
  
    <a href="https://www.noppanit.com/posts/im-never-going-back-to-modern-editor-again" class="no-underline f1 light-blue hover-silver nl5 fl-l ph3">‹</a>
  
  
    <a href="https://www.noppanit.com/posts/code-review-with-the-world" class="no-underline f1 light-blue hover-silver nr5 fr-l ph3">›</a>
  
</section>
    </div>
    <footer class="mw7 center tc pt3 pb4 silver">
      Built with Jekyll using <a href="http://github.com/muan/scribble" class="link silver hover-blue pv1">Scribble</a>.
      <img src="https://www.noppanit.com/images/scribble2.png" alt="scribble" class="mt4 db center" />
    </footer>
  </body>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

</html>
