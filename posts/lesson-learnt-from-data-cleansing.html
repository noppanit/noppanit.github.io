
<!doctype>
<html lang="en">
  <head>
    <meta content='Lesson learnt from data cleansing. Part I - Noppanit' name='title' />
    <meta content='Lesson learnt from data cleansing. Part I - Noppanit' name='og:title' />
    <title>Lesson learnt from data cleansing. Part I - Noppanit</title>
    <link href='https://www.noppanit.com/images/fav.png' rel='shortcut icon'>
<link href='https://www.noppanit.com/stylesheets/style.css' rel='stylesheet' type='text/css' />
<link href='https://www.noppanit.com/stylesheets/syntax.css' rel='stylesheet' type='text/css' />

<meta content='width=device-width, initial-scale=1.0, user-scalable=no' name='viewport'>
<meta content='text/html; charset=utf-8' http-equiv='content-type' />

  <meta content='https://www.noppanit.com/posts/lesson-learnt-from-data-cleansing' property='og:url' />
  <meta content="Lately, I have been experimenting on Kaggle competition. This is the one I chose because I want to use neo4j to give ..." property='og:description' />
  <meta content="article" property="og:type" />

<!-- - -->





  </head>
  <body class="lh-copy dark-gray pa0 f6 sans-serif bg-super-white">
    <header class="tc mt4">
      <a href="https://www.noppanit.com">
        <img src="https://www.noppanit.com/images/scribble.png" alt="Home" width="53" height="59">
      </a>
      <p>Noppanit</p>
    </header>
    <div class="mw7 bg-white mt4 mb3 center br2-ns bt bb ba-ns b--light-gray">
      <nav class="bb b--light-gray pv4 tc" aria-label="Main">
        
      </nav>

      <main class="tl f6 relative pa4 pa5-ns overflow-hidden">
        
          <div class="mb4">
            <div class="fw600 light-silver mt1">07 Feb 2013</div>
            <h1 class="ttu f3 mt0 lh-title cb mb2">
              
              Lesson learnt from data cleansing. Part I
            </h1>
            
          </div>
        
        <div class="markdown-body">
          <p>Lately, I have been experimenting on <a href="http://www.kaggle.com/c/event-recommendation-engine-challenge">Kaggle competition</a>. This is the one I chose because I want to use neo4j to give some recommendation or in a sense I want to do unsupervised learning. From day one I faced a lot of problem dealing with a lot of data and they are not clean in a way. For example, in this competition, there is users dataset which contains all the users. And there is a friend dataset which contains all the friends. The data look like this.</p>

<p><img src="https://www.noppanit.com/wp-content/uploads/2013/02/Screen-shot-2013-02-01-at-00.08.50.png" alt="users dataset" class="aligncenter size-full wp-image-1028 cool_border" /></p>

<p><img src="https://www.noppanit.com/wp-content/uploads/2013/02/Screen-shot-2013-02-01-at-00.08.28.png" alt="friends dataset" class="aligncenter size-full wp-image-1029 cool_border" /></p>

<p>The first dataset I could dump everything into neo4j without any problem because it’s just 30000 records it only took me 5 mins to do it. However, the second dataset was kind of a problem because the column <strong>friends</strong> not all of the ids exist in users database which means the users don’t exist. So, I had to check if the ids exist in user dataset or not. It turned out that the friends dataset is quite large (about 50 MB) and it could be 3000 ids in one column. So, my first thought would be just to do it one by one.</p>

<p><strong>Frist attempt</strong><br />
So, what I did first was to dump the whole users dataset to neo4j. And then for loop to check if id exists then insert if not just ignore it. I used cypher to check if the id exists. It turned out that I left my computer for 24 hours and it went just only 10% of the data. It was really slow. One thing from this was that I used neography which means it’s using REST api which usually it’s slower than embedded code. And I couldn’t wait for a whole week just to import the data. So, I moved on. The slow part was the checking every time so I guess it would be nice to clean the data before I dump that to neo4j.</p>

<p><strong>Second attempt</strong><br />
I tried to use Google Refine to cross check two datasets but it couldn’t even pass the stage <strong>“split multi-valued cells”</strong> which to split column values to rows. Google Refine uses too much ram. I even tried to start EC2 instance but it froze along the way as well. I posted the question and got the solution <a href="http://stackoverflow.com/questions/14636919/google-refine-cross-reference-between-row-and-column">here</a></p>

<p><strong>Third attempt</strong><br />
I used MySQL to join the tables and and check if the ids exist. Dumping all the data to MySQL was pretty easy my plain old PHP and MySQL. It turned out the friends dataset got around 38 Million rows. And here’s the script I used to check if the id doesn’t exit spit it out and delete it.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> SELECT uf.id, uf.friend_id, u.user_id FROM eventify.UserFriends uf LEFT JOIN eventify.Users u on uf.friend_id = u.user_id WHERE u.user_id is NULL LIMIT 1
</code></pre></div></div>

<p>It was also really slow since I just use my Macbook and didn’t even turn MySQL performance. So I moved on again.</p>

<p><strong>Final attempt</strong><br />
I couldn’t believe that this will be the simplest and most effective way. What I did was to dump the whole users dataset to <strong>Hash</strong> in Ruby and check the friends dataset which surprisingly it only took Ruby 10 mins to do that. Then it only took Ruby and neo4j around 2 hours to import the cleaned data.</p>

<blockquote>
  <p>So lesson learnt for me was if anything can be done in memory do that first.</p>
</blockquote>

<p>I’ll try to dump the rest in and blog about how did I get on with recommendation engine from neo4j.</p>


        </div>
        <p class="mt4">
  Til next time,<br>
  noppanit
  <span class="silver">at 00:00</span>
</p>
<img src="https://www.noppanit.com/images/scribble3.png" alt="scribble" />

      </main>
      <section class="fixed-l mw7 center w-100 top-50 tc pb4 nt4">
  
    <a href="https://www.noppanit.com/posts/enable-defalter-compression-for-sinatra-on-herok" class="no-underline f1 light-blue hover-silver nl5 fl-l ph3">‹</a>
  
  
    <a href="https://www.noppanit.com/posts/lesson-learnt-from-data-cleansing-part-ii" class="no-underline f1 light-blue hover-silver nr5 fr-l ph3">›</a>
  
</section>
    </div>
    <footer class="mw7 center tc pt3 pb4 silver">
      Built with Jekyll using <a href="http://github.com/muan/scribble" class="link silver hover-blue pv1">Scribble</a>.
      <img src="https://www.noppanit.com/images/scribble2.png" alt="scribble" class="mt4 db center" />
    </footer>
  </body>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

</html>
