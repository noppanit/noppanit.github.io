
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>My Blog</title>
  <meta name="author" content="Noppanit Charassinvichai">

  
  <meta name="description" content="I have been researching on how to get a context out of a piece of text. There are lots of techniques to do that, Information Retriever, Noun Chunker &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://noppanit.github.io/posts/6/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="My Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Blog</a></h1>
  
    <h2>My Blog</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="noppanit.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/how-to-index-all-wikipedia-english-data-using-elasticsearc/">How to Index All Wikipedia (English) Data Using Elasticsearch?</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-04-04T00:00:00-04:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have been researching on how to get a context out of a piece of text. There are lots of techniques to do that, Information Retriever, Noun Chunker, Text Classification and etc. One technique that I have been trying to do but it&#8217;s quite difficult because of the resources and cannot be done on-the-fly is from wikipedia. Wikipedia is like a central repository where human being can contribute to add more content for other people. So, every article is written by human with some potential keywords in the text. For example, if the article is about dog, it&#8217;s likely that in the text contains word &#8220;dog&#8221; or other synonyms. However, by just indexing all the wikipedia data is not quite enough, because that means you can only search through the content which Google or Bing is doing a better job obviously. What I&#8217;m interested in <a href="http://www.elasticsearch.org/" title="elasticsearch">Elasticsearch</a> is <a href="http://en.wikipedia.org/wiki/Cosine_similarity" title="cosine similarity">Cosine Similarity</a> which roughly speaking is a technique to determine how similar between two vectors. Elasticsearch provide just that which is <a href="http://www.elasticsearch.org/guide/reference/api/more-like-this/">&#8220;More like this&#8221;</a> functionality. More like this technique in elasticsearch is a way you can easily measure how similar two pieces of content is. The usage is easy, just index all the text you want it to be searchable and input another piece of text then elasticsearch will give you a score.</p>

<p>Instead of doing everything yourself, Elasticsearch has a plugin called <a href="https://github.com/elasticsearch/elasticsearch-river-wikipedia" title="elasticsearch wikipedia">elasticsearch-river-wikipedia</a> which will do everything for you from downloading all the dumped wiki data to index all the data for you to search immediately. However, I found little documentation for this one on how to use this for a Elasticsearch virgin like me.</p>

<p>So, here&#8217;s how I do it.</p>

<p>First of course you need to install elasticsearch. If you&#8217;re on a Mac, I suggest you to use Homebrew.</p>

<p>Then you need to install the plugin by following <a href="https://github.com/elasticsearch/elasticsearch-river-wikipedia">these steps</a>. And that should be it. However, I have looked at the plugin sourcecode and it will download the 30GB data and unzip it and index it for you in the background. There&#8217;s not logs or any indication. I find it quite hard to see when it&#8217;s finished. I actually had to listen to my CPU fan to stop then I realised that it&#8217;s done indexing. But here&#8217;s what I did to make it slightly faster and more obvious.</p>

<p>The downloading takes a while depends on your connection. So, I suggest you to download the file <a href="http://download.wikimedia.org/enwiki/latest/enwiki-latest-pages-articles.xml.bz2" title="Wiki dump">yourself</a> and then unzip it. Then use this command to create index.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl -XPUT localhost:9203/_river/wikipedia/_meta -d <span class="s1">&#39;</span>
</span><span class='line'><span class="s1">{</span>
</span><span class='line'><span class="s1">    &quot;type&quot; : &quot;wikipedia&quot;,</span>
</span><span class='line'><span class="s1">    &quot;wikipedia&quot; : {</span>
</span><span class='line'><span class="s1">        &quot;url&quot; : &quot;file:///${PATH_TO_YOUR_FOLDER}/enwiki-latest-pages-articles.xml&quot;</span>
</span><span class='line'><span class="s1">    }</span>
</span><span class='line'><span class="s1">}</span>
</span><span class='line'><span class="s1">&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will speed up the process a lot and it will reduce the chance that your JVM will face PERMGen exception because the plugin will try to unzip the 30GB data for you as well. Then just wait for the indexing to finish. You can try to see the status of your node from your browser by typing this <a href="http://localhost:9200/_stats">http://localhost:9200/_stats</a> in your favourite browser. The size of the finished index is around 40GB.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/maybe-i-have-just-got-scroogled/">Maybe I Have Just Got Scroogled?</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-03-15T00:00:00-04:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I think everybody might know this campaign from Microsoft, <a href="http://www.scroogled.com/">http://www.scroogled.com/</a>. Microsoft claims that they don&#8217;t index our email or track everything in our life in order to sell ads and Google is evil and we should switch to outlook.com. At first I think it&#8217;s cool if I could get some really cool ads or relevant ads but after seeing this I&#8217;m kinda scared of Google now.</p>

<p><img src="http://www.noppanit.com/wp-content/uploads/2013/03/Screen-Shot-2013-03-15-at-09.08.49.png"></p>

<p>Exactly I&#8217;m not English but I work in London and I&#8217;ve been sent to Germany for 9 months now for work. So, I&#8217;m kinda an expat from England. Also, recently I have been talking to the finance team of my company about tax refund because I&#8217;ve been spending time in Germany more than 163 days. Of course, I&#8217;m using Gmail as the form of communication.</p>

<p>The ad is super accurate, but the question is about the privacy. Is it good to have Google indies all of your data including your private conversation in order to get relevant ads? Well, I don&#8217;t know but if looking at the other way around it&#8217;s good for business because they can really focus on correct target customers.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/javascript-tdd-on-file-upload/">JavaScript TDD on on File Upload.</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-03-10T00:00:00-05:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Right now, I&#8217;m trying to do HTML5 file upload but I also want to write some test as well. So, I just want to post it here. <a href="http://postposttechnical.com/2011/03/spying-with-jasmine/">http://postposttechnical.com/2011/03/spying-with-jasmine/</a> This blog post really inspires me on how to use Jasmine to drive JavaScript test. Maybe my code is wrong, but any feedback is welcome.</p>

<p>So, I have this code</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">Uploader</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">file</span> <span class="o">=</span> <span class="nx">file</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Uploader</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span>  <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">upload_file</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">file_content</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">file_data</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
</span><span class='line'>    <span class="nx">file_data</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="nx">file</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">file_data</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;mimetype&#39;</span><span class="p">,</span> <span class="nx">file</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">file_data</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nx">file_content</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">file_data</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="nx">file</span><span class="p">.</span><span class="nx">size</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class='line'>          <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;/upload/file&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">data</span><span class="o">:</span> <span class="nx">file_content</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">contentType</span><span class="o">:</span> <span class="nx">file</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>          <span class="p">},</span>
</span><span class='line'>          <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>          <span class="p">},</span>
</span><span class='line'>          <span class="nx">xhr</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>              <span class="nx">myXhr</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajaxSettings</span><span class="p">.</span><span class="nx">xhr</span><span class="p">();</span>
</span><span class='line'>              <span class="k">if</span><span class="p">(</span><span class="nx">myXhr</span><span class="p">.</span><span class="nx">upload</span><span class="p">){</span>
</span><span class='line'>                  <span class="nx">myXhr</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">progressbar</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Upload progress is not supported.&quot;</span><span class="p">);</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>              <span class="k">return</span> <span class="nx">myXhr</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">showPreview</span><span class="p">(</span><span class="nx">file_content</span><span class="p">,</span> <span class="nx">thumbnailDiv</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">image</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;img&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">image</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span>  <span class="nx">file_content</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">thumbnailDiv</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">image</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">upload</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">file_content</span> <span class="o">=</span> <span class="p">{},</span>
</span><span class='line'>        <span class="nx">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileReader</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">reader</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">file_content</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">showPreview</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">thumbnailDiv</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">upload_file</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">file</span><span class="p">,</span> <span class="nx">file_content</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</span><span class='line'>      <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>      <span class="nx">reader</span><span class="p">.</span><span class="nx">readAsDataURL</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">file</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">})();</span>
</span></code></pre></td></tr></table></div></figure>


<p>And this is my test</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;Uploader&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">eventListener</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">fakeFile</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="nx">spyOn</span><span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="s2">&quot;ajax&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">eventListener</span> <span class="o">=</span> <span class="nx">jasmine</span><span class="p">.</span><span class="nx">createSpy</span><span class="p">();</span>
</span><span class='line'>    <span class="nx">spyOn</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="s2">&quot;FileReader&quot;</span><span class="p">).</span><span class="nx">andReturn</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">addEventListener</span><span class="o">:</span> <span class="nx">eventListener</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">readAsDataURL</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// do nothing.</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">uploader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uploader</span><span class="p">(</span><span class="nx">fakeFile</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;should upload a file successfully&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">thumbnailElement</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;&lt;/div&gt;&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">uploader</span><span class="p">.</span><span class="nx">upload</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">progressbar</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="nx">thumbnailDiv</span> <span class="o">:</span> <span class="nx">thumbnailElement</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span><span class="nx">eventListener</span><span class="p">.</span><span class="nx">mostRecentCall</span><span class="p">.</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="nx">toEqual</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">eventListener</span><span class="p">.</span><span class="nx">mostRecentCall</span><span class="p">.</span><span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]({</span>
</span><span class='line'>      <span class="nx">target</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">result</span> <span class="o">:</span> <span class="s1">&#39;file content&#39;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">mostRecentCall</span><span class="p">.</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;url&quot;</span><span class="p">]).</span><span class="nx">toEqual</span><span class="p">(</span><span class="s2">&quot;/upload/file&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">mostRecentCall</span><span class="p">.</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]).</span><span class="nx">toEqual</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;should show a preview image&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">thumbnailElement</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">thumbnailElement</span><span class="p">.</span><span class="nx">append</span> <span class="o">=</span> <span class="nx">jasmine</span><span class="p">.</span><span class="nx">createSpy</span><span class="p">(</span><span class="s2">&quot;fake thumbnail div&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">uploader</span><span class="p">.</span><span class="nx">upload</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">progressbar</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="nx">thumbnailDiv</span> <span class="o">:</span> <span class="nx">thumbnailElement</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">eventListener</span><span class="p">.</span><span class="nx">mostRecentCall</span><span class="p">.</span><span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]({</span>
</span><span class='line'>      <span class="nx">target</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">result</span> <span class="o">:</span> <span class="s1">&#39;file_content&#39;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span><span class="nx">thumbnailElement</span><span class="p">.</span><span class="nx">append</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
</span><span class='line'>    <span class="nx">hasFileSrc</span> <span class="o">=</span> <span class="nx">thumbnailElement</span><span class="p">.</span><span class="nx">append</span><span class="p">.</span><span class="nx">mostRecentCall</span><span class="p">.</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">src</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;file_content&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span><span class="nx">hasFileSrc</span><span class="p">).</span><span class="nx">toNotEqual</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>I had to spy on FileReader in order to test it. But it really help me improve my code.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/flask-and-rq-example-for-heroku/">Flask and RQ Example for Heroku</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-03-08T00:00:00-05:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have been struggling to find any example on the Internet on how to do long polling on Heroku with Flask and RQ. I know it&#8217;s relatively easy, but I just want to make it clear for my future self.</p>

<p>It&#8217;s really simple.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/get_word_count&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;POST&#39;</span><span class="p">])</span>
</span><span class='line'><span class="k">def</span> <span class="nf">get_word_count</span><span class="p">():</span>
</span><span class='line'>    <span class="n">data_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>    <span class="n">job</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">word_counter</span><span class="o">.</span><span class="n">count_words</span><span class="p">,</span> <span class="n">data_json</span><span class="p">[</span><span class="s">&quot;sentence&quot;</span><span class="p">])</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">job</span><span class="o">.</span><span class="n">key</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&quot;/get_word_count_result/&lt;job_key&gt;&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
</span><span class='line'><span class="k">def</span> <span class="nf">get_word_count_result</span><span class="p">(</span><span class="n">job_key</span><span class="p">):</span>
</span><span class='line'>    <span class="n">job_key</span> <span class="o">=</span> <span class="n">job_key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;rq:job:&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">job</span> <span class="o">=</span> <span class="n">Job</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">job_key</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">is_finished</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;Not yet&quot;</span><span class="p">,</span> <span class="mi">202</span>
</span><span class='line'>    <span class="k">else</span><span class="p">:</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">),</span> <span class="mi">200</span>
</span></code></pre></td></tr></table></div></figure>


<p>The key is here</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">job</span> <span class="o">=</span> <span class="n">Job</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">job_key</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The fetch command is used to get the job by job_id, you can also use</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">get_current_job</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>as well, but I just want to make it clear that if there are more concurrent requests coming in, I&#8217;ll get the right result back.</p>

<p>I posted an example here. <a href="https://github.com/noppanit/heroku-flask-rq-worker" title="Python with RQ on Heroku">https://github.com/noppanit/heroku-flask-rq-worker</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/lesson-learnt-from-data-cleansing-part-ii/">Lesson Learnt From Data Cleansing. Part II</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-02-11T00:00:00-05:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Ok as I have done the <a href="http://www.noppanit.com/lesson-learnt-from-data-cleansing/" title="data cleansing part I">part I</a> I have learnt another thing from data cleansing. I believe the best tool for data analysis is <a href="http://www.r-project.org/" title="R">R</a> but the learning is quite steep but I&#8217;m trying to learn it right now. Hopefully if I can get some results from this with neo4j I could move on to use R to get some more statistical results.</p>

<p>Now, the second challenge I got was that the CSV file is about 1GB with around 100 columns and I was trying to use Ruby to parse that. Obviously, I got <strong>Killed</strong> results from my Terminal even before I got to the first line. So, Ruby has to load everything into memory and parse that. But as I&#8217;m running everything in my small Mac. It seems to be quite a challenging. So, what I have done is to dump everything to MySQL. This time works really good. MySQL has <a href="http://dev.mysql.com/doc/refman/5.1/en/load-data.html" title="Load data mysql">LOAD DATA FILE</a> which can load CSV file into a table. It only took me around <string>20 seconds</strong> to load 1GB of CSV into a table. I dumped the table out and it was around 1GB which is not too bad. Now the next challenge was that I also had to filter out the events that were created by real users (I&#8217;m doing this <a href="http://www.kaggle.com/c/event-recommendation-engine-challenge" title="kaggle competition">Kaggle competition</a>). I had around 3 million rows which is now that much. And I used MySQL which comes with XAMPP. My first query took me around 8 hours without spitting any results back. So, I gave up and did a couple research on how to make MySQL faster, but I&#8217;m not a DBA and I didn&#8217;t have time to read the whole book about MySQL performance tuning.</p>

<p><strong>First attempt</strong><br/>
Index joined columns and changed the table schema to something small. I used <strong>VARCHAR(50)</strong> instead of <strong>VARCHAR(255)</strong> and of course I used <strong>NUMBER(3)</strong> instead of <strong>VARCHAR(5)</strong></p>

<p>Still, I couldn&#8217;t get the results back in 1 hour which I think MySQL is better than that.</p>

<p><strong>Second attempt</strong><br/>
So, I moved on to the next one. It looked like everybody on the Internet suggested <strong>key_buffer_size</strong> or <strong>key_buffer</strong> to 4G. And changed some of the variables to pimp MySQL up a little bit.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  * query\_cache\_type = 1
</span><span class='line'>  * query\_cache\_size = 128M
</span><span class='line'>  * query\_cache\_limit = 128M&gt;</span></code></pre></td></tr></table></div></figure>


<p>Still, I couldn&#8217;t get the results back.</p>

<p>And suddenly I caught something in my <strong>my.cnf</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Example MySQL config file for small systems.
</span><span class='line'># This is for a system with little memory (&lt;= 64M) where MySQL is only used
</span><span class='line'># from time to time and it's important that the mysqld daemon
</span><span class='line'># doesn't use much resources.
</span><span class='line'>#
</span></code></pre></td></tr></table></div></figure>


<p>What is said was that XAMPP is tuned for a very small computer to be able to run basic PHP and MySQL application which is why my MySQL performed really bad in this case.</p>

<p><strong>Final attempt</strong><br/>
I started my EC2 instance with 7GB of memory and installed MySQL (normal one) also some of the performance tuning variables. Now, I got the results back in just under 20 seconds to join two tables with around 3 millions rows.</p>

<blockquote><p>Lesson learnt: Do not use MySQL from XAMPP for data that is big and use query that would get smaller results. For example, in my case instead of filtering out user_ids that don&#8217;t exist in Users table. I filtered user_ids that exist instead.</p></blockquote>

<p>I also thought about of using BigQuery from Google but I guess my data is rather small and can hardly be called big data. Next time, I might try to use BigQuery just for fun.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/lesson-learnt-from-data-cleansing/">Lesson Learnt From Data Cleansing. Part I</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-02-07T00:00:00-05:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Lately, I have been experimenting on <a href="http://www.kaggle.com/c/event-recommendation-engine-challenge">Kaggle competition</a>. This is the one I chose because I want to use neo4j to give some recommendation or in a sense I want to do unsupervised learning. From day one I faced a lot of problem dealing with a lot of data and they are not clean in a way. For example, in this competition, there is users dataset which contains all the users. And there is a friend dataset which contains all the friends. The data look like this.</p>

<p><img src="http://www.noppanit.com/wp-content/uploads/2013/02/Screen-shot-2013-02-01-at-00.08.50.png" alt="users dataset" class="aligncenter size-full wp-image-1028 cool_border" /></p>

<p><img src="http://www.noppanit.com/wp-content/uploads/2013/02/Screen-shot-2013-02-01-at-00.08.28.png" alt="friends dataset" class="aligncenter size-full wp-image-1029 cool_border" /></p>

<p>The first dataset I could dump everything into neo4j without any problem because it&#8217;s just 30000 records it only took me 5 mins to do it. However, the second dataset was kind of a problem because the column <strong>friends</strong> not all of the ids exist in users database which means the users don&#8217;t exist. So, I had to check if the ids exist in user dataset or not. It turned out that the friends dataset is quite large (about 50 MB) and it could be 3000 ids in one column. So, my first thought would be just to do it one by one.</p>

<p><strong>Frist attempt</strong><br/>
So, what I did first was to dump the whole users dataset to neo4j. And then for loop to check if id exists then insert if not just ignore it. I used cypher to check if the id exists. It turned out that I left my computer for 24 hours and it went just only 10% of the data. It was really slow. One thing from this was that I used neography which means it&#8217;s using REST api which usually it&#8217;s slower than embedded code. And I couldn&#8217;t wait for a whole week just to import the data. So, I moved on. The slow part was the checking every time so I guess it would be nice to clean the data before I dump that to neo4j.</p>

<p><strong>Second attempt</strong><br/>
I tried to use Google Refine to cross check two datasets but it couldn&#8217;t even pass the stage <strong>&#8220;split multi-valued cells&#8221;</strong> which to split column values to rows. Google Refine uses too much ram. I even tried to start EC2 instance but it froze along the way as well. I posted the question and got the solution <a href="http://stackoverflow.com/questions/14636919/google-refine-cross-reference-between-row-and-column">here</a></p>

<p><strong>Third attempt</strong><br/>
I used MySQL to join the tables and and check if the ids exist. Dumping all the data to MySQL was pretty easy my plain old PHP and MySQL. It turned out the friends dataset got around 38 Million rows. And here&#8217;s the script I used to check if the id doesn&#8217;t exit spit it out and delete it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> SELECT uf.id, uf.friend_id, u.user_id FROM eventify.UserFriends uf LEFT JOIN eventify.Users u on uf.friend_id = u.user_id WHERE u.user_id is NULL LIMIT 1</span></code></pre></td></tr></table></div></figure>


<p>It was also really slow since I just use my Macbook and didn&#8217;t even turn MySQL performance. So I moved on again.</p>

<p><strong>Final attempt</strong><br/>
I couldn&#8217;t believe that this will be the simplest and most effective way. What I did was to dump the whole users dataset to <strong>Hash</strong> in Ruby and check the friends dataset which surprisingly it only took Ruby 10 mins to do that. Then it only took Ruby and neo4j around 2 hours to import the cleaned data.</p>

<blockquote><p>So lesson learnt for me was if anything can be done in memory do that first.</p></blockquote>

<p>I&#8217;ll try to dump the rest in and blog about how did I get on with recommendation engine from neo4j.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/enable-defalter-compression-for-sinatra-on-herok/">Enable Defalter Compression for Sinatra on Heroku</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-01-15T00:00:00-05:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>You guys must have heard about PageSpeed test from Google. It&#8217;s a really cool plugin for Chrome to let you know how you can optimize your webpage faster. I have been using it for a while but I couldn&#8217;t get my head around gzip compression which it seems that Google has taken that seriously. If you want the science bit. Here&#8217;s the <a href="https://developers.google.com/speed/articles/gzip" title="gzip">article</a> from Google.</p>

<p>And here&#8217;s the quickstart bit. The most simplest way is to put the compression in <strong>config.ru</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;./server&#39;</span>
</span><span class='line'><span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Deflater</span>
</span><span class='line'><span class="n">run</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Application</span>
</span></code></pre></td></tr></table></div></figure>


<p>And that&#8217;s it I hope this will save you sometime.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/forest-walking-in-luxembourg-mullerthal-trail/">Forest Walking in Luxembourg : Mullerthal Trail</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-01-11T00:00:00-05:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p style="text-align: center;">
  <a href="#" rel="attachment wp-att-1016"><img class="aligncenter  wp-image-1016 cool_border" alt="Mullerthal Trail" src="http://www.noppanit.com/wp-content/uploads/2013/01/IMG_0021-edited-682x1024.jpg" width="477" height="717" /></a>
</p>


<p>I have been travelling a lot due to work and sometimes I&#8217;m tried of getting to the airport, catching the train or getting on a crowded bus. So, I thought it would be nice just to get away. And just a couple hours I was in Luxembourg the country where people go there to just tick the box.</p>

<blockquote><p>One important thing is that if you have a connection at Charles de Gaulle International Airport at Paris. Please spare some time at least 1 hour even though it&#8217;s just one building away. The airport is really big and maybe you have to pass the security check again after you landed. I almost missed my connection because I thought it&#8217;s just 2F and 2D how long would it take to walk. It&#8217;s actually about 20 min walk-and-run.</p></blockquote>

<p>After I landed, the airport is small and not much to see or shop. Without hesitation, for a be-backpacker like me taxi is out of the question. Luxembourg airport has direct buses to the city centre. Just hop on the bus there and tell the driver <strong>main train station or hauptbahnhof</strong>. They use French as the main language but everybody understands German.</p>

<p>And yeh as I said I was bored with the city so I arrived at the main train station and headed straight to the bus stop to get on the bus number 111 or 110 to Echternach for <a href="http://www.mullerthal-trail.lu/en/" title="Mullerthal Trail">Mullerthal Trail</a>. The ticket is just 2 Euro and the journey takes about 45 min. It&#8217;s a really good deal.</p>

<p>After arriving at the village the temperature was about 2 degree it&#8217;s nice and chilly. I was at the wrong time because it was December and it&#8217;s not the best time for Luxembourg but I still think it&#8217;s really worth a visit for a nice forest walking. Got off the bus and the first thing you will notice is the sign to Mullerthal Trail, so no need to ask anybody just look around a little bit. I found the trail was quite easy and the rock formations are really beautiful. I think you could camp there as well if you&#8217;re well prepared.</p>

<p><a href="#" rel="attachment wp-att-1014"><img class="size-medium wp-image-1014 cool_border alignnone" alt="Signs in Mullerthal Trail" src="http://www.noppanit.com/wp-content/uploads/2013/01/IMG_0009_edited-1-300x200.jpg" width="300" height="200" /></a></p>

<p><a href="#" rel="attachment wp-att-1015"><img class="size-medium wp-image-1015 cool_border alignnone" alt="Mullerthal Trail" src="http://www.noppanit.com/wp-content/uploads/2013/01/IMG_0002_edited-1-300x200.jpg" width="300" height="200" /></a></p>

<p>I walked from Echternach to Berdorf because I didn&#8217;t have enough time. The day was short during the winter and I didn&#8217;t want to spend a night there without something warm. From Berform you can get a bus back to Luxembourg City easily with the same bus number 110 or 111.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/little-javascript-to-check-if-the-page-contain-multiple-ids/">Little JavaScript to Check if the Page Contain Multiple IDs</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-01-08T00:00:00-05:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I know this shouldn&#8217;t happen at all these days, but as you have a lot of people contributing to one single repository. This thing might happen. So, this is just purely for myself. I just use jQuery to create a little util method which is executed every time the browser is loaded to check if the page contains any multiple IDs.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">detect_dub_ids</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">dupIds</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;[id]&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">$ids</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;[id=&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">$ids</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">$ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">dupIds</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="nx">dupIds</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="p">},</span>
</span><span class='line'>
</span><span class='line'><span class="nx">get_display_text_for_dup_ids</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ids</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="p">{},</span>
</span><span class='line'>        <span class="nx">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">jQuery</span><span class="p">(</span><span class="nx">ids</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="nx">h</span><span class="p">[</span><span class="nx">value</span><span class="p">])</span> <span class="p">{;</span>
</span><span class='line'>            <span class="nx">h</span><span class="p">[</span><span class="nx">value</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">h</span><span class="p">[</span><span class="nx">value</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">value</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">h</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">text</span> <span class="o">+=</span> <span class="s2">&quot;#&quot;</span><span class="o">+</span><span class="nx">k</span><span class="o">+</span> <span class="s2">&quot; (&quot;</span><span class="o">+</span><span class="nx">h</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">length</span><span class="o">+</span><span class="s2">&quot;) times &quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="nx">text</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/what-if-matching-exct-string-is-not-enough/">What if Matching Exact String Is Not Enough, Basic Fuzzy Search That You Want to Know.</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-01-01T00:00:00-05:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>First of all, I&#8217;m not a researcher what I post here is just my experiment that I do it myself.</p>

<p>I have this problem when I want to match string but not <strong>exact match</strong>. For example, I have this string <strong>&#8220;I really love The Matrix movie because of this quote &#8216;welcome to the real world'&#8221;</strong> and I have a bunch of tags in my database such as <strong>&#8220;The Matrix&#8221;, &#8220;welcome to the real world&#8221;, &#8220;red pill&#8221;, &#8220;blue pill&#8221;</strong>. So, if I want to match the tags with the string I could do regular expression like this or actually I could do the exact match and still get the correct one.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/.*world.*/</span></code></pre></td></tr></table></div></figure>


<p>That would give me what I want. However, what if I have another movie <strong>&#8220;The day after tomorrow&#8221;</strong> with tags <strong>&#8220;world&#8221;</strong>. If I search with word that string against the tags I will get two movies. So, what can I do? I did some Google and found <a href="http://en.wikipedia.org/wiki/Approximate_string_matching">fuzzy search</a> and I picked <a href="http://en.wikipedia.org/wiki/Levenshtein_distance">&#8220;Levenshtein&#8221;</a>. I&#8217;m not good at maths so I can&#8217;t really explains in technical correctly. But basically, it&#8217;s a technique to look into two strings and count every time you have to <string>&#8220;edit&#8221;</strong> to make the strings exact match. For example,</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>I love you # string 1
</span><span class='line'>
</span><span class='line'>I also love you # string 2</span></code></pre></td></tr></table></div></figure>


<p>The distance would be <strong>1</strong> because it takes <strong>1</strong> edit to make the two strings exact match. We have to add <strong>also</strong> or delete <strong>also</strong> 1 time.</p>

<p>So from the example above.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c"># Distance 12</span>
</span><span class='line'><span class="n">puts</span> <span class="n">Levenshtein</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="s">&quot;welcome to the real world&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">),</span> <span class="s">&quot;I really love The Matrix movie because of this quote &#39;welcome to the real world&#39;&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">))</span>
</span><span class='line'><span class="c"># Distance 15</span>
</span><span class='line'><span class="n">puts</span> <span class="n">Levenshtein</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="s">&quot;world&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">),</span> <span class="s">&quot;I really love The Matrix movie because of this quote &#39;welcome to the real world&#39;&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>So this way, the tag <strong>welcome to the real world</strong> is more likely to match with the string <strong>I really love The Matrix movie because of this quote &#8216;welcome to the real world</strong></p>

<p>I use this <a href="http://rubygems.org/gems/levenshtein" title="levenshtein algorithm">Gem</a> for this experiment</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/7">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/5">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/code-review-with-the-world/">Code Review With the World</a>
      </li>
    
      <li class="post">
        <a href="/maps-all-parking-signs-in-nyc/">Maps All Parking Signs in NYC.</a>
      </li>
    
      <li class="post">
        <a href="/im-never-going-back-to-modern-editor-again/">I&#8217;m Never Going Back to Modern Editor Again.</a>
      </li>
    
      <li class="post">
        <a href="/how-to-start-doing-tdd-for-jquery-plugin/">How to Start Doing TDD for jQuery Plugin.</a>
      </li>
    
      <li class="post">
        <a href="/the-most-basic-example-of-linear-regression/">The Most Basic Example of Linear Regression</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/noppanit">@noppanit</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'noppanit',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Noppanit Charassinvichai -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'noppanit';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
