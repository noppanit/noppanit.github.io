<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Maps all parking signs in NYC.</title>
  <meta name="description" content="This post might be too easy for any Data-viz people but as a beginner tapping in this area. It took me quite a long time to figure it out so I just want to s...">

  
  
  <link rel="stylesheet" href="http://localhost:4000/assets/style.css">

  <link rel="canonical" href="http://localhost:4000/maps-all-parking-signs-in-nyc/">
  <link rel="alternate" type="application/rss+xml" title="Noppanit" href="http://localhost:4000/feed.xml">

  <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>

  
  <!-- font-smoothing is only applied on dark themes -->
  <body class="font-smoothing">

    <header class="px-2 clearfix">
  <!-- <div class="left-lg absolute-lg left-0 top-0 sm-width-full mt-2">
    <a class="no-underline-hover px-1" href="/">
      <span class="inline-block h4 hide-sm ml-2">&#x261c;</span>
    </a>
    <a class="italic no-underline" href="/">
       home
    </a>
  </div> -->
  <div class="right-lg absolute-lg right-0 top-0">
    <ul class="mt-1 mt-lg-2 mr-2 mr-lg-3">
      <li class="inline-block block-lg text-right ml-1 ml-lg-0">
        <a class="italic h4 bold no-underline" href="/">
          <!-- Noppanit -->
          Home
        </a>
      </li>
      
        
      
        
      
        
      
        
      
    </ul>
  </div>
</header>


    <div>
      <article class="container mx-auto px-2" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="mt-4 mb-2 clearfix header-text">
    <h1 class="h0 inline-block py-2 mt-4 header-title">Maps all parking signs in NYC.</h1>
    <div class="clearfix mb-4 py-1">
      <p class="h4 lh-condensed"><time datetime="2015-07-30T00:00:00-04:00" itemprop="datePublished">Jul 30, 2015</time></p>
      <div class="col-1 sm-width-full border-top-thick">
      </div>
    </div>
  </div>

  <div class="prose py-4" itemprop="articleBody">
      <p>This post might be too easy for any Data-viz people but as a beginner tapping in this area. It took me quite a long time to figure it out so I just want to share this hoping that it might save people’s time.</p>

<p>Parking in NYC is really a pain, especially street parking where there’re lots of signs and regulations. There are some apps on Android and iPhone that you can download and see signs but I haven’t been able to find the one that suits my needs. I want an application that can tell me where to circle arounds on which day and time to find parking spot. For example, I parked my car on a Tuesday which has street cleaning on Wednesday and Friday from 8:30 to 9:30. That means I have to move the car on Wednesday morning to find a spot for Friday. The problem is I don’t know what’s around me. The closest application I find is <a href="http://www.nycparklife.com/streetparker/">http://www.nycparklife.com/streetparker/</a> which it doesn’t have Manhattan.</p>

<h2 id="getting-the-data">Getting the data</h2>

<p>So, I googled and thank NYC.gov that provides the <a href="http://www.nyc.gov/html/dot/html/about/datafeeds.shtml#parking">data</a> for us. First, I played around with the csv files but they don’t have coordinates that I can place location on the map. And I have no experience dealing with shapefiles.</p>

<h2 id="extracting-the-data">Extracting the data</h2>

<p>After a few hours of mangling and munching the csv with Pandas and R. I would not be able to get the exact locations of all the signs. So I turned to shapefile hoping that I might get lucky. And I found this <a href="http://www.shpescape.com/">http://www.shpescape.com/</a> which promised to transform shapefile to <a href="https://support.google.com/fusiontables/answer/2571232?hl=en">Google Fusion Table</a>. Awesome! I went ahead and tried it. It works great! but it only gives you the first 100,000 rows. So dug deeper. After another few hours of googling I found <a href="http://www.qgis.org/en/site/">qGis</a> which is a opensource project that you can use to open and view shapefile.</p>

<p>Here’s the example.</p>

<p><img src="/wp-content/uploads/2015/07/Screenshot-2015-07-30-12.52.32.jpg" alt="Parking signs on Qgis" /></p>

<p>One thing I learnt was that you cannot just click <strong>Open</strong> and choose the file. What you need to do is to <string>Add Vector Layer&lt;/strong&gt;. You can use shortcut **Ctrl+Shift+v**</string></p>

<p><img src="/wp-content/uploads/2015/07/Screenshot-2015-07-30-12.55.56.jpg" alt="Add Vector Layer" /></p>

<h2 id="export-to-google-fusion">Export to Google Fusion</h2>

<p>Now what we need is to import what we have to Google Fusion Table. How are we going to turn this beautiful layer to Google Maps. We need CSV…</p>

<p>In QGis you can download the file as CSV. It’s in <strong>Layer &gt; Save As</strong>. You just need to make sure that <strong>Geometry</strong> has to be set so you get the coordinates.</p>

<p><img src="/wp-content/uploads/2015/07/Screenshot-2015-07-30-13.02.06.jpg" alt="Save to CSV" /></p>

<h2 id="import-to-google-fusion-table">Import to Google Fusion Table</h2>

<p>Now we can use that CSV to import to Google Fusion. It would look something like this.</p>

<p><img src="/wp-content/uploads/2015/07/Screenshot-2015-07-30-13.04.35.jpg" alt="Google Fusion Table" /></p>

<p>what you need to make sure is that you need to specify which fields are Lat, Long so Google can plot that for you.</p>

<p>Here’s how you do it.</p>

<p><img src="/wp-content/uploads/2015/07/Screenshot-2015-07-30-13.05.41.jpg" /></p>

<p>The click <strong>change</strong> You will see something like this and you can choose which field you want to be Longitude or Latitude.</p>

<p><img src="/wp-content/uploads/2015/07/Screenshot-2015-07-30-13.06.33.jpg" alt="Set Location" /></p>

<p>Once the coordinates have set we can go to Map tab and see beautiful little dots that show where all the signs are in NYC.</p>

<p><img src="/wp-content/uploads/2015/07/Screenshot-2015-07-30-13.07.47.jpg" alt="Parking signs in Google Fusion Table" /></p>

<p>Walla! Now you have something you can build an application on top of it. The next post, I will create an application on top of this map to make use of our data.</p>

<h2 id="things-i-have-tried-and-failed">Things I have tried and failed</h2>

<p>I’ve tried using <a href="https://github.com/OSGeo/proj.4">Proj4</a> on both R and Python to convert X,Y WGS84 to Lat, Long. Here’s my little snippet.</p>

<pre><code class="language-plain">
data = read.csv('./parking_regulation.csv')

library(proj4)
proj4string &lt;- "+proj=lcc +lat_1=40.66666666666666 +lat_2=41.03333333333333 +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs"
latlong_list&lt;-list()
calculate_long_lat &lt;- function(x,y) {
  
  # Source data
  xy &lt;- data.frame(x=x, y=y)
  
  # Transformed data
  pj &lt;- project(xy, proj4string, inverse=TRUE)
  latlon &lt;- data.frame(lat=pj$y, lon=pj$x)
  latlong_list[['latlong']] &lt;- latlon
}

apply(data[,c('x','y')], 1, function(y) calculate_long_lat(y['x'], y['y']))

</code></pre>

<p>The result is not quite accurate which I think it’s because I need to find a correct <strong>proj4string</strong>.</p>

<p>Python has the same wrapper which is quite what I want as well.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">python</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line">from pyproj import Proj
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">import pandas as pd
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">data = pd.read_csv('parking_regulation.csv')
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">p = Proj(r'+proj=lcc +lat_1=40.66666666666666 +lat_2=41.03333333333333 +lat_0=40.16666666666666 +lon_0=-74 +x_0=300000 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs')
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">def cal_long_lat(row):
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">    return p(row['x'], row['y'],inverse=True)
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">data['lon'], data['lat'] = zip(data.apply (lambda row: cal_long_lat (row),axis=1))
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">data.head()</div></div></pre></div></figure>

<p>I will need to learn more about State Pane and what is the correct format.</p>

<p>This article takes 2 pomodoros to complete.</p>


  </div>
</article>

<div class="container mx-auto px-2 py-2 clearfix">
  <!-- Use if you want to show previous and next for all posts. -->



  <div class="col-4 sm-width-full left mr-lg-4 mt-3">
    <a class="no-underline-hover py-1 block" href="http://localhost:4000/im-never-going-back-to-modern-editor-again/">
      <span class="h5 bold">Previous</span>
      <p class="bold h3 link-primary mb-1">I am never going back to modern editor again.</p>
      <p>Ok, the title might be a little bit exaggerating. But let me clear this up first. I still use modern...</p>
    </a>
  </div>
  
  
  <div class="col-4 sm-width-full left mt-3">
    <a class="no-underline-hover py-1 block" href="http://localhost:4000/code-review-with-the-world/">
      <span class="h5 bold">Next</span>
      <p class="bold h3 link-primary mb-1">Code Review with the world</p>
      <p>## TL;DR If you don&#8217;t know [Code Review Stackoverflow][1] you gotta get on it now. It works and it&#8217;s awesome....</p>
    </a>
  </div>


</div>

    </div>

    <div class="container mx-auto clearfix mt-2 mt-lg-4 px-2">
  <div class="border-top-thick">
    <p class="col-8 sm-width-full left py-2 mb-0">This project is maintained by <a class="text-accent" href="https://github.com/noppanit">noppanit</a></p>
    <ul class="list-reset right clearfix sm-width-full py-2 mb-2 mb-lg-0">
      <li class="inline-block mr-1">
        <a href="https://twitter.com/share" class="twitter-share-button" data-hashtags="Noppanit">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      </li>
      <li class="inline-block">
        <a class="github-button" href="https://github.com/noppanit/" data-icon="octicon-star" data-count-href="noppanit//stargazers" data-count-api="/repos/noppanit/#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star noppanit/ on GitHub">Star</a>
      </li>
    </ul>
  </div>
</div>


  </body>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

</html>