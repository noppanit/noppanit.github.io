<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: python | My Blog]]></title>
  <link href="https://www.noppanit.com/blog/categories/python/atom.xml" rel="self"/>
  <link href="https://www.noppanit.com/"/>
  <updated>2016-11-12T14:05:01-05:00</updated>
  <id>https://www.noppanit.com/</id>
  <author>
    <name><![CDATA[Noppanit Charassinvichai]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Game of life for dummies]]></title>
    <link href="https://www.noppanit.com/game-of-life-for-dummies/"/>
    <updated>2016-11-11T23:10:25-05:00</updated>
    <id>https://www.noppanit.com/game-of-life-for-dummies</id>
    <content type="html"><![CDATA[<h2 id="game-of-life">Game of life</h2>

<p>It’s a <a href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life">game</a> invented by the British mathematician John Horton Conway and the game goes like this.</p>

<p>```</p>

<p>Given a board with m by n cells, each cell has an initial state live (1) or dead (0). Each cell interacts with its eight neighbors (horizontal, vertical, diagonal) using the following four rules (taken from the above Wikipedia article):</p>

<p>Any live cell with fewer than two live neighbors dies, as if caused by under-population.
Any live cell with two or three live neighbors lives on to the next generation.
Any live cell with more than three live neighbors dies, as if by over-population..
Any dead cell with exactly three live neighbors becomes a live cell, as if by reproduction.</p>

<p>```</p>

<p>Most people know this game because you might be asked during any technical interview to design Game of Life on a whiteboard. But for me, when I first learn how to program I was asked to code Game of Life and it was actually kinda fun. Especially, if you do it in TDD.</p>

<h2 id="why-this-post-then">Why this post then?</h2>
<p>I know there’s a lot of posts out there solving Game of Life in any possible known computer languages, but I feel like all of them are too hard to understand or use advanced library like <code>numpy</code> to solve the problem which makes it really hard to understand for me. Also, if I would like to understand how to solve the problem and if I can’t explain this simply that means I don’t understand at all.</p>

<h2 id="algorithm">Algorithm</h2>
<p>The simplest algorithm goes like this.</p>

<ol>
  <li>Count all the live cells around 8x8 matrix of a cell.</li>
  <li>Determine if the next state, the cell lives or dies based on the rules.</li>
</ol>

<p>So, if you can count all the live cells around a cell, you’re pretty much there.</p>

<h2 id="naive-approach">Naive approach</h2>

<p>``` python
class Solution(object):
    def gameOfLife(self, board):
        “””
        :type board: List[List[int]]
        :rtype: void Do not return anything, modify board in-place instead.
        “””
        m = len(board)
        n = len(board[0]) if m else 0</p>

<pre><code>    temp_board = [[0] * n for i in range(m)]

    def count_cell(i, j):
      """
      :type i: Column row
      :type j: Column column
      Count all the cells around the cell[i][j]
      """
      
      list_of_tuples = [(i-1, j-1), (i-1, j), (i-1, j+1),
          (i, j-1), (i, j), (i, j+1),
          (i+1, j-1), (i+1, j), (i+1, j+1)]

      count = 0
      for l in list_of_tuples:
        x, y = l
        if x &gt;= 0 and y &gt;= 0 and x &lt; m and y &lt; n:
          if x is not i or y is not j:
            if board[x][y] == 1:
              count += 1
        
      return count

    for i in range(m):
      for j in range(n):
        count = count_cell(i, j)
        temp_board[i][j] = count

    for i in range(m):
      for j in range(n):
        cell = board[i][j]
        count = temp_board[i][j]
        if cell == 1:
          if count &lt; 2:
            board[i][j] = 0
          elif count is 3 or count is 2:
            board[i][j] = 1
          elif count &gt; 3:
            board[i][j] = 0
        else:
          if count == 3:
            board[i][j] = 1
</code></pre>

<p>board = [[0,0,0,0,0],
    [0,0,1,0,0],
    [0,0,1,0,0],
    [0,0,1,0,0],
    [0,0,0,0,0]]</p>

<p>Solution().gameOfLife(board)
print(board)</p>

<p>```</p>

<p>The naive approach is really simple and stupid. There’s a method to count all the cells and put that to a temp board so it can be used to determined the next cycle of the game.</p>

<p>The complexity would be <code>O(m * n)</code> but the space would be <code>O(m * n)</code> as well</p>

<h2 id="first-refactor">First refactor</h2>
<p>The first refactoring would be to just loop through the surrounding cell with the check for boundaries.</p>

<p>```python</p>

<p>class Solution(object):
    def gameOfLife(self, board):
        “””
        :type board: List[List[int]]
        :rtype: void Do not return anything, modify board in-place instead.
        “””
        m = len(board)
        n = len(board[0]) if m else 0</p>

<pre><code>    temp_board = [[0] * n for i in range(m)]

    def count_cell(i, j):
      """
      :type i: Column row
      :type j: Column column
      Count all the cells around the cell[i][j]
      """
      lives = 0

      for I in range(max(i-1, 0), min(i+2, m)):
        for J in range(max(j-1, 0), min(j+2, n)):
          if I is not i or J is not j:
            lives += board[I][J]
      return lives

    for i in range(m):
      for j in range(n):
        count = count_cell(i, j)
        temp_board[i][j] = count

    for i in range(m):
      for j in range(n):
        cell = board[i][j]
        count = temp_board[i][j]
        if cell == 1:
          if count &lt; 2:
            board[i][j] = 0
          elif count is 3 or count is 2:
            board[i][j] = 1
          elif count &gt; 3:
            board[i][j] = 0
        else:
          if count == 3:
            board[i][j] = 1
</code></pre>

<p>board = [[0,0,0,0,0],
    [0,0,1,0,0],
    [0,0,1,0,0],
    [0,0,1,0,0],
    [0,0,0,0,0]]</p>

<p>Solution().gameOfLife(board)
print(board)</p>

<p>```</p>

<p>It’s a bit better don’t you think?</p>

<h2 id="second-refactor">Second refactor</h2>

<p>Now the first two approaches, we have to have a temp board to calculate the next state. Let’s see if we can do better than that by manipulating the board in-place instead of having a temp board.</p>

<p>Someone on the <a href="https://discuss.leetcode.com/topic/29054/easiest-java-solution-with-explanation">leetcode discussion</a> suggested bit manipulation to store the state of the cell which I think it’s a brilliant idea. However, I feel like there’s not much explanation so I’m going to try to explain it here.</p>

<p>The problem with the second approach is that we have to have a <code>temp</code> board to store the number of surrounding cells so that we can flip it after the whole board has been counted. The problem with this approach is space complexity if the board is really large we need to double the size of memory to store the state of the board.</p>

<p>For example:</p>

<p>```
      2nd   1st
0 0 (dead, dead)
0 1 (dead, live)
1 0 (live, dead)
1 1 (live, live)</p>

<p>```</p>

<p>We have this board</p>

<p>```</p>

<p>[[0, 0, 0],
 [0, 1, 0],
 [1, 0, 0]]</p>

<p>```</p>

<p>If we look at the coordinate <code>(1,1)</code> the cell is live and only has <code>1</code> surrounding living cell which according to the rule the cell dies because of under-population in the next state. So we can represent that cell as <code>0 1</code>. The right-most bit represent the first state and the left-most bit represent the next state. So in the case, the cell has value <code>1</code> which after we shift it to the right with <code>cell[i][j] &gt;&gt;= 1</code>. It’s going to be <code>0</code> which means the cell dies in the next state.</p>

<p>So to refactor the code we will get something like this.</p>

<p>```python</p>

<p>”””
This is because we only care about live cell that’s going to live on to the next state
And the dead cell that’s going to come alive
“””</p>

<h1 id="if-the-cell-is-live-and-the-surrounding-cells-count-is-either-two-or-three-the-cell-lives-on-to-the-next-state">If the cell is live and the surrounding cells count is either two or three, the cell lives on to the next state</h1>
<p>if board[i][j] == 1 and count &gt;= 2 and count &lt;= 3:
    board[i][j] = 3
# If the cell is dead and the surrounding cells count is exactly three, the cell lives on to the next state
if board[i][j] == 0 and count == 3:
    board[i][j] = 2</p>

<h1 id="then-we-flip-to-the-next-state">Then we flip to the next state</h1>
<p>for i in range(m):
    for j in range(n):
        board[i][j] »= 1</p>

<p>```</p>

<p>To sum up we will get the code which looks something like this</p>

<p>```python</p>

<p>m = len(board)
n = len(board[0]) if m else 0</p>

<p>temp_board = [[0] * n for i in range(m)]</p>

<p>def count_cell(i, j):
    lives = 0
    for I in range(max(i - 1, 0), min(i + 2, m)):
        for J in range(max(j - 1, 0), min(j + 2, n)):
            if I is not i or J is not j:
                lives += board[I][J] &amp; 1 
    return lives</p>

<p>for i in range(m):
  for j in range(n):
    count = count_cell(i, j)
    if board[i][j] == 1 and count &gt;= 2 and count &lt;= 3:
        board[i][j] = 3
    if board[i][j] == 0 and count == 3:
        board[i][j] = 2</p>

<p>for i in range(m):
    for j in range(n):
        board[i][j] »= 1</p>

<p>```</p>

<p>You might notice about this line.</p>

<p>```python</p>

<p>lives += board[I][J] &amp; 1</p>

<p>```</p>

<p>This is because we want to just loop through the board once and if we change the number of the current cell to be ready for the next state, the later cell will get the wrong count. To <code>&amp; 1</code> means we just want to get the current state of the cell whether it’s dead or alive regardless of the total count of the surrounding cells.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Cosine Similarity for Dummies]]></title>
    <link href="https://www.noppanit.com/cosine-similarity-for-dummies/"/>
    <updated>2015-10-29T21:35:17-04:00</updated>
    <id>https://www.noppanit.com/cosine-similarity-for-dummies</id>
    <content type="html"><![CDATA[<p>Have you ever wonder how recommender system works? Or How Spotify or Amazon recommends what songs you might like or what product you might like to buy. I do. In this post, I’m going to try to explain how the recommendation algorithm works. First, let’s create a perfect scenario. I like to create an ideal example, it’s easier to understand.</p>

<p>Let’s say you have a very simple data of movies that users like collected from your site and you would like to match those people together based on their interests. How would you do that? One of the most popular methods is <a href="https://en.wikipedia.org/wiki/Cosine_similarity">Cosine Similarity</a>. When I first saw the name I was so confused; why Cosine? I remember when I was a kid I remembered my teacher told me about trigonometry so why does it have to do with that?</p>

<p>Here’s the sample data.</p>

<p>User 1 likes these movies</p>

<p><code>plain
['Superman', 'Walking Dead', 'CSI']
</code></p>

<p>User 2 likes these movies</p>

<p><code>plain
['Superman', 'Walking Dead', 'CSI']
</code></p>

<p>Even without any algorithm we can say that two users like the same movies. But we want the algorithm to tell us that the two users are very similar. Before we get into the mathematical formula world. We have to understand what a vector is?</p>

<h1 id="whats-a-vector">What’s a vector?</h1>
<p>In Pyhsics, a vector has two things; magnitude and direction which can be written as</p>

<p><img src="/wp-content/uploads/2015/11/vector.png" title="Vector" ></p>

<p>I’d like to explain what a vector is but this <a href="http://immersivemath.com/ila/ch02_vectors/ch02.html">site</a> explains a lot better.</p>

<p>However, in Computer Science, 1-dimentional array is called a <a href="http://www.cplusplus.com/reference/vector/vector/">vector</a>. But <code>list</code> in Python cannot perform vector operation so we have to use <code>numpy</code> or you have to build your own which I don’t recommend.</p>

<p>Now we know what a vector is but how does it relate to Cosine Similarity. In a nutshell, Cosine Similarity is <a href="http://blog.christianperone.com/2013/09/machine-learning-cosine-similarity-for-vector-space-models-part-iii/">a measure that calculates the cosine of the angle between them</a>.</p>

<h1 id="cosine-similarity">Cosine Similarity</h1>

<p><img src="/wp-content/uploads/2015/11/cosine_similarity.gif" title="Cosine Similarity" ></p>

<p>In order to find the angle between the two vectors, we need to find the dot product of the two vectors as the formula below.</p>

<p>\begin{align}
\text{cosine-similarity}(A,B) = \frac{\left&lt;A,B\right&gt;}{||A||\cdot||B||}
\end{align}</p>

<h1 id="show-me-the-code">Show me the code</h1>

<p>Ok. enough about explanation, show me the code.</p>

<p>``` python
import numpy as np</p>

<p>def cosin_sim(v, w):
    return np.dot(v, w) / np.math.sqrt(np.dot(v, v) * np.dot(w, w))</p>

<h1 id="if-movie-is-in-the-list-of-movies-and-0-is-not">1 if movie is in the list of movies and 0 is not.</h1>
<p>cosin_sim([1, 1, 1], [1, 1, 1])
# 1.0</p>

<p>```</p>

<p>In the perfect example, we can see that the two users have the same interests.</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Python's Monkey patch for Dummies]]></title>
    <link href="https://www.noppanit.com/pythons-monkey-patch/"/>
    <updated>2015-10-25T19:00:27-04:00</updated>
    <id>https://www.noppanit.com/pythons-monkey-patch</id>
    <content type="html"><![CDATA[<p>Alright, I’m going to cut to the chase here. I’m having problems with Monkey patching in Python and I want to make it clear for myself and anybody who might stumble upon my post in the future. So, what’s the big deal here?</p>

<p>Let’s say you have a model</p>

<p><code>python models/person.py
def get_name():
	// Doing some database lookup
	// But I'm going to return a hard-coded name for now
	return 'John Doe'
</code></p>

<p>And you have a Phonebook class that’s trying to access the database</p>

<p>``` python models/phonebook.py
from models.person import get_name</p>

<p>class Phonebook(object):</p>

<pre><code>def lookup(self):
    return get_name() ```
</code></pre>

<p>Now, we know that <code>get_name</code> is accessing some database and we don’t want that to happen in unit test. We would like to stub that.</p>

<p>Coming from Java, I’d write my test like this.</p>

<p>``` python tests/test_phonebook.py
from unittest import TestCase, mock
from models.phonebook import Phonebook</p>

<p>class PhonebookTestCase(TestCase):</p>

<pre><code>@mock.patch('models.person.get_name')
def test_main(self, mock_person):
    mock_person.return_value = 'Another Name'
    self.assertEqual('Another Name', Phonebook().lookup())
</code></pre>

<p>```</p>

<p>It makes sense right? I want to stub something from <code>models.person.get_name</code> so I’m telling <code>mock</code> to stub that class but my test failed miserably.</p>

<p>``` plain
tests/test_phonebook.py F</p>

<p>=================================================================================== FAILURES ===================================================================================
<strong>__</strong><strong>__</strong><strong>__</strong><strong>__</strong><strong>__</strong><strong>__</strong><strong>__</strong><strong>__</strong><strong>__</strong><strong>__</strong><strong>__</strong><strong>__</strong>_ PhonebookTestCase.test_main <strong>__</strong><strong>__</strong><strong>__</strong><strong>__</strong><strong>__</strong><strong>__</strong><strong>__</strong><strong>__</strong><strong>__</strong><strong>__</strong><strong>__</strong><strong>__</strong>__</p>

<p>self = &lt;tests.test_phonebook.PhonebookTestCase testMethod=test_main&gt;, mock_person = <magicmock name="get_name" id="4460968592"></magicmock></p>

<pre><code>@mock.patch('models.person.get_name')
def test_main(self, mock_person):
    mock_person.return_value = 'Another Name' &gt;       self.assertEqual('Another Name', Phonebook().lookup()) E       AssertionError: 'Another Name' != 'John Doe' E       - Another Name E       + Noppanit
</code></pre>

<p>```</p>

<p>Why? Because <code>patch</code> behaves differently than what we expected. This is explained in <a href="http://www.voidspace.org.uk/python/mock/patch.html#where-to-patch">Where to patch</a>. I’m going to summarize for you. Basically, <code>patch</code> is going to take effect from where it is looked up… For me after reading that I’m still confused. I might be the only one who’s confused here so I’m going to continue writing.</p>

<p>If we take a closer look how <a href="http://effbot.org/zone/import-confusion.htm">import</a> behaves in Python, it would be clearer.</p>

<p><code>python models/phonebook.py
from models.person import get_name
</code></p>

<p>The line says please import <code>get_name</code> to the namespace in <code>models/phonebook.py</code>. So, when we want to use it we can just called <code>get_name()</code> without having to write <code>models.person.get_name()</code> Now if you change your code to be</p>

<p>``` python models/phonebook.py
import models.person</p>

<p>class Phonebook(object):</p>

<pre><code>def lookup(self):
    return models.person.get_name()
</code></pre>

<p>```</p>

<p>You test would pass. Because now our Phonebook is looking up <code>models.person.get_name</code> namespace instead of having function <code>get_name</code> being imported to its namespace.</p>

<p>Now if you want the old test to work, your <code>patch</code> has to be changed to</p>

<p>``` python tests/test_phonebook.py</p>

<p>from unittest import TestCase, mock
from models.phonebook import Phonebook</p>

<p>class PhonebookTestCase(TestCase):</p>

<pre><code>@mock.patch('models.phonebook.get_name')
def test_main(self, mock_person):
    mock_person.return_value = 'Another Name'
    self.assertEqual('Another Name', Phonebook().lookup())
</code></pre>

<p>```</p>

<p>That’s it for now. If you’re wondering why this is the case then looking at the source code of patch would help a lot. It’s using <a href="https://docs.python.org/3.5/library/functions.html#__import__"><code>__import__</code></a> function.</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Python to import your dumped tweets to MongoDb]]></title>
    <link href="https://www.noppanit.com/python-import-dumped-tweets-mongodb/"/>
    <updated>2013-09-04T00:00:00-04:00</updated>
    <id>https://www.noppanit.com/python-import-dumped-tweets-mongodb</id>
    <content type="html"><![CDATA[<p>I’m playing around with my tweets. Just so you’re aware that you could download your entire tweets and play around with it. The format is JSON so I think it makes perfect sense to dump this to MongoDB. But you can’t just import that straight away it needs some manipulation. I’m not good at Python so the code here might be tedious for python dudes. I’m going to use this data in my analysis, which will be captured in the next blog post.</p>

<p>``` python
import pymongo
from pprint import pprint</p>

<p>path = ‘./data’
client = pymongo.MongoClient(‘localhost’, 27017)
db = client.tweets
def main():
        for infile in glob.glob( os.path.join(path, “*.js”)):
                content = open(infile).read()
                indexOfFirstEqualSign = content.find(“=”) + 1
                pureJson = content[indexOfFirstEqualSign:]
                jsonifedData = json.loads(pureJson)
                db.tweets_collection.insert(jsonifedData)</p>

<p>if <strong>name</strong> == “<strong>main</strong>”:
        main()
```</p>

<p>The data is kept in <strong>data</strong> folder.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Flask and RQ example for Heroku]]></title>
    <link href="https://www.noppanit.com/flask-and-rq-example-for-heroku/"/>
    <updated>2013-03-08T00:00:00-05:00</updated>
    <id>https://www.noppanit.com/flask-and-rq-example-for-heroku</id>
    <content type="html"><![CDATA[<p>I have been struggling to find any example on the Internet on how to do long polling on Heroku with Flask and RQ. I know it’s relatively easy, but I just want to make it clear for my future self.</p>

<p>It’s really simple.</p>

<p>``` python
@app.route(‘/get_word_count’, methods=[‘POST’])
def get_word_count():
    data_json = json.loads(request.data)
    job = q.enqueue(word_counter.count_words, data_json[“sentence”])
    return job.key</p>

<p>@app.route(“/get_word_count_result/<job_key>", methods=['GET'])
def get_word_count_result(job_key):
    job_key = job_key.replace("rq:job:", "")
    job = Job.fetch(job_key, connection=conn)</job_key></p>

<pre><code>if(not job.is_finished):
    return "Not yet", 202
else:
    return str(job.result), 200 ```
</code></pre>

<p>The key is here</p>

<p><code>python
job = Job.fetch(job_key, connection=conn)
</code></p>

<p>The fetch command is used to get the job by job_id, you can also use</p>

<p><code>python
get_current_job()
</code></p>

<p>as well, but I just want to make it clear that if there are more concurrent requests coming in, I’ll get the right result back.</p>

<p>I posted an example here. <a href="https://github.com/noppanit/heroku-flask-rq-worker" title="Python with RQ on Heroku">https://github.com/noppanit/heroku-flask-rq-worker</a></p>

]]></content>
  </entry>
  
</feed>
