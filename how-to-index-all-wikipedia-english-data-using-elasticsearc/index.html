<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>How to index all wikipedia (English) data using Elasticsearch?</title>
  <meta name="description" content="I have been researching on how to get a context out of a piece of text. There are lots of techniques to do that, Information Retriever, Noun Chunker, Text Cl...">

  
  
  <link rel="stylesheet" href="http://localhost:4000/assets/style.css">

  <link rel="canonical" href="http://localhost:4000/how-to-index-all-wikipedia-english-data-using-elasticsearc/">
  <link rel="alternate" type="application/rss+xml" title="Noppanit" href="http://localhost:4000/feed.xml">

  <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>

  
  <!-- font-smoothing is only applied on dark themes -->
  <body class="font-smoothing">

    <header class="px-2 clearfix">
  <!-- <div class="left-lg absolute-lg left-0 top-0 sm-width-full mt-2">
    <a class="no-underline-hover px-1" href="/">
      <span class="inline-block h4 hide-sm ml-2">&#x261c;</span>
    </a>
    <a class="italic no-underline" href="/">
       home
    </a>
  </div> -->
  <div class="right-lg absolute-lg right-0 top-0">
    <ul class="mt-1 mt-lg-2 mr-2 mr-lg-3">
      <li class="inline-block block-lg text-right ml-1 ml-lg-0">
        <a class="italic h4 bold no-underline" href="/">
          <!-- Noppanit -->
          Home
        </a>
      </li>
      
        
      
        
      
        
      
        
      
    </ul>
  </div>
</header>


    <div>
      <article class="container mx-auto px-2" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="mt-4 mb-2 clearfix header-text">
    <h1 class="h0 inline-block py-2 mt-4 header-title">How to index all wikipedia (English) data using Elasticsearch?</h1>
    <div class="clearfix mb-4 py-1">
      <p class="h4 lh-condensed"><time datetime="2013-04-04T00:00:00-04:00" itemprop="datePublished">Apr 4, 2013</time></p>
      <div class="col-1 sm-width-full border-top-thick">
      </div>
    </div>
  </div>

  <div class="prose py-4" itemprop="articleBody">
      <p>I have been researching on how to get a context out of a piece of text. There are lots of techniques to do that, Information Retriever, Noun Chunker, Text Classification and etc. One technique that I have been trying to do but it’s quite difficult because of the resources and cannot be done on-the-fly is from wikipedia. Wikipedia is like a central repository where human being can contribute to add more content for other people. So, every article is written by human with some potential keywords in the text. For example, if the article is about dog, it’s likely that in the text contains word “dog” or other synonyms. However, by just indexing all the wikipedia data is not quite enough, because that means you can only search through the content which Google or Bing is doing a better job obviously. What I’m interested in <a href="http://www.elasticsearch.org/" title="elasticsearch">Elasticsearch</a> is <a href="http://en.wikipedia.org/wiki/Cosine_similarity" title="cosine similarity">Cosine Similarity</a> which roughly speaking is a technique to determine how similar between two vectors. Elasticsearch provide just that which is <a href="http://www.elasticsearch.org/guide/reference/api/more-like-this/">“More like this”</a> functionality. More like this technique in elasticsearch is a way you can easily measure how similar two pieces of content is. The usage is easy, just index all the text you want it to be searchable and input another piece of text then elasticsearch will give you a score.</p>

<p>Instead of doing everything yourself, Elasticsearch has a plugin called <a href="https://github.com/elasticsearch/elasticsearch-river-wikipedia" title="elasticsearch wikipedia">elasticsearch-river-wikipedia</a> which will do everything for you from downloading all the dumped wiki data to index all the data for you to search immediately. However, I found little documentation for this one on how to use this for a Elasticsearch virgin like me.</p>

<p>So, here’s how I do it.</p>

<p>First of course you need to install elasticsearch. If you’re on a Mac, I suggest you to use Homebrew.</p>

<p>Then you need to install the plugin by following <a href="https://github.com/elasticsearch/elasticsearch-river-wikipedia">these steps</a>. And that should be it. However, I have looked at the plugin sourcecode and it will download the 30GB data and unzip it and index it for you in the background. There’s not logs or any indication. I find it quite hard to see when it’s finished. I actually had to listen to my CPU fan to stop then I realised that it’s done indexing. But here’s what I did to make it slightly faster and more obvious.</p>

<p>The downloading takes a while depends on your connection. So, I suggest you to download the file <a href="http://download.wikimedia.org/enwiki/latest/enwiki-latest-pages-articles.xml.bz2" title="Wiki dump">yourself</a> and then unzip it. Then use this command to create index.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-XPUT</span> localhost:9203/_river/wikipedia/_meta <span class="nt">-d</span> <span class="s1">'
{
    "type" : "wikipedia",
    "wikipedia" : {
        "url" : "file:///${PATH_TO_YOUR_FOLDER}/enwiki-latest-pages-articles.xml"
    }
}
'</span>
</code></pre></div></div>

<p>This will speed up the process a lot and it will reduce the chance that your JVM will face PERMGen exception because the plugin will try to unzip the 30GB data for you as well. Then just wait for the indexing to finish. You can try to see the status of your node from your browser by typing this http://localhost:9200/_stats in your favourite browser. The size of the finished index is around 40GB.</p>


  </div>
</article>

<div class="container mx-auto px-2 py-2 clearfix">
  <!-- Use if you want to show previous and next for all posts. -->



  <div class="col-4 sm-width-full left mr-lg-4 mt-3">
    <a class="no-underline-hover py-1 block" href="http://localhost:4000/maybe-i-have-just-got-scroogled/">
      <span class="h5 bold">Previous</span>
      <p class="bold h3 link-primary mb-1">Maybe I have just got scroogled?</p>
      <p>I think everybody might know this campaign from Microsoft, http://www.scroogled.com/. Microsoft claims that they don’t index our email or track...</p>
    </a>
  </div>
  
  
  <div class="col-4 sm-width-full left mt-3">
    <a class="no-underline-hover py-1 block" href="http://localhost:4000/why-i-join-live-below-the-line/">
      <span class="h5 bold">Next</span>
      <p class="bold h3 link-primary mb-1">Why I join Live Below the Line?</p>
      <p>I believe all of us have heard this problem before through all kinds of channels, the Internet, TV, Facebook, Twitter,...</p>
    </a>
  </div>


</div>

    </div>

    <div class="container mx-auto clearfix mt-2 mt-lg-4 px-2">
  <div class="border-top-thick">
    <p class="col-8 sm-width-full left py-2 mb-0">This project is maintained by <a class="text-accent" href="https://github.com/noppanit">noppanit</a></p>
    <ul class="list-reset right clearfix sm-width-full py-2 mb-2 mb-lg-0">
      <li class="inline-block mr-1">
        <a href="https://twitter.com/share" class="twitter-share-button" data-hashtags="Noppanit">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      </li>
      <li class="inline-block">
        <a class="github-button" href="https://github.com/noppanit/" data-icon="octicon-star" data-count-href="noppanit//stargazers" data-count-api="/repos/noppanit/#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star noppanit/ on GitHub">Star</a>
      </li>
    </ul>
  </div>
</div>


  </body>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

</html>