<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>How to install Chef-Solo without root access?</title>
  <meta name="description" content="I know the title it’s stupid. And if you arrived at this post, I know your this question will pop up in your head, “Why on earth you want to do that?”. Chef ...">

  
  
  <link rel="stylesheet" href="http://localhost:4000/assets/style.css">

  <link rel="canonical" href="http://localhost:4000/how-to-install-chef-solo-without-root-access/">
  <link rel="alternate" type="application/rss+xml" title="Noppanit" href="http://localhost:4000/feed.xml">

  <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>

  
  <!-- font-smoothing is only applied on dark themes -->
  <body class="font-smoothing">

    <header class="px-2 clearfix">
  <!-- <div class="left-lg absolute-lg left-0 top-0 sm-width-full mt-2">
    <a class="no-underline-hover px-1" href="/">
      <span class="inline-block h4 hide-sm ml-2">&#x261c;</span>
    </a>
    <a class="italic no-underline" href="/">
       home
    </a>
  </div> -->
  <div class="right-lg absolute-lg right-0 top-0">
    <ul class="mt-1 mt-lg-2 mr-2 mr-lg-3">
      <li class="inline-block block-lg text-right ml-1 ml-lg-0">
        <a class="italic h4 bold no-underline" href="/">
          <!-- Noppanit -->
          Home
        </a>
      </li>
      
        
      
        
      
        
      
        
      
    </ul>
  </div>
</header>


    <div>
      <article class="container mx-auto px-2" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="mt-4 mb-2 clearfix header-text">
    <h1 class="h0 inline-block py-2 mt-4 header-title">How to install Chef-Solo without root access?</h1>
    <div class="clearfix mb-4 py-1">
      <p class="h4 lh-condensed"><time datetime="2013-08-23T00:00:00-04:00" itemprop="datePublished">Aug 23, 2013</time></p>
      <div class="col-1 sm-width-full border-top-thick">
      </div>
    </div>
  </div>

  <div class="prose py-4" itemprop="articleBody">
      <p>I know the title it’s stupid. And if you arrived at this post, I know your this question will pop up in your head, “Why on earth you want to do that?”. Chef is built in the assumption that it has root access and yeah it makes perfect sense. Without root access it’s like I want to hire a cleaner to clean my house but I want to get my house cleaned without giving my house key to the cleaner. It’s the same thing here.</p>

<p>However, I’m here to just talk about how to do this in a very ugly and hacky way.</p>

<p>Problem:<br />
One day on a client side, they said we want you to deploy the application to our production VM server, but we cannot give you sudo or root access. Of course, it makes sense why would you give some guy root access. The IT guy gives me one folder which you can do anything as long as you stay inside that folder. We won’t have any problem because our app is basically just a java application with Jetty container, so it doesn’t matter where it lives. Now, here comes the problem we want to deploy our application anytime we want and we want to do the <a href="http://martinfowler.com/bliki/PhoenixServer.html" title="PhoenixServer">PhoenixServer</a> pattern. But in this case, it’s just going to be semi phoenixServer, because we’re not going to wipe the whole box out. So we thought, yeah we could use Chef to provision the server. Great!. But how can you even install Chef without sudo or root access? If you go to Chef and download the Linux version it will be an RPM which obviously it needs root access to install that, which we don’t have. Hmm, what are we gonna do?</p>

<p>Solution:<br />
So we thought, well we just need Chef-solo because it’s just going to be one server. Chef is written in Ruby and our Centos VM doesn’t even come Ruby. The problem gets bigger, how can we install Ruby without root access. Ha! now here’s the tricky part. Chef is Ruby, Ruby is C. We have C, so we could compile Ruby and use gem to install Chef. Woohoo! Sounds easy right? By the way, Chef comes with embedded-ruby already that’s why when you install Chef you don’t need to install Ruby first. The Chef guys cleverly embedded Ruby inside Chef with all the gems and deploy that to <strong>/opt/chef</strong>. You can find more information <a href="http://www.opscode.com/chef/install/" title="Chef install">here</a>. So, we could do the same thing but we need to compile Ruby and dependencies to our folder. Ok, I’ll cut to the chest now. All we need is Ruby and Chef gem. In order to install, ruby which I found out you just need three minimum libraries, zlib, yaml and openssl. Here’s how to do it.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Install Openssl</span>
wget https://www.openssl.org/source/openssl-1.0.0k.tar.gz
<span class="nb">tar </span>zxvf openssl-1.0.0k.tar.gz
<span class="nb">cd </span>openssl-1.0.0k
./config shared <span class="nt">-fPIC</span> <span class="nt">--prefix</span><span class="o">=</span>/home/centos/ruby <span class="nt">--openssldir</span><span class="o">=</span>/home/centos/ruby/ssl
make <span class="o">&amp;&amp;</span> make install
<span class="nb">cd</span> /home/centos

<span class="c">#Install zlib</span>
wget http://zlib.net/zlib-1.2.8.tar.gz
<span class="nb">tar </span>xzvf zlib-1.2.8.tar.gz
<span class="nb">cd </span>zlib-1.2.8
./configure <span class="nt">--prefix</span><span class="o">=</span>/home/centos/ruby
make <span class="o">&amp;&amp;</span> make install
<span class="nb">cd</span> /home/centos

<span class="c">#Install Yaml</span>
wget http://pyyaml.org/download/libyaml/yaml-0.1.4.tar.gz
<span class="nb">tar </span>xzvf yaml-0.1.4.tar.gz
<span class="nb">cd </span>yaml-0.1.4
./configure <span class="nt">--disable-install-doc</span> <span class="nt">--prefix</span><span class="o">=</span>/home/centos/ruby
make <span class="o">&amp;&amp;</span> make install
<span class="nb">cd</span> /home/centos

<span class="c">#Install Ruby 1.9.3</span>
wget ftp://ftp.ruby-lang.org/pub/ruby/1.9/ruby-1.9.3-p448.tar.gz
<span class="nb">tar </span>xzvf ruby-1.9.3-p448.tar.gz
<span class="nb">cd </span>ruby-1.9.3-p448
./configure <span class="nt">--prefix</span><span class="o">=</span>/home/centos/ruby <span class="nt">--enable-shared</span> <span class="nt">--disable-install-doc</span> <span class="nt">--with-opt-dir</span><span class="o">=</span>/home/centos/ruby
make <span class="o">&amp;&amp;</span> make install
<span class="nb">cd</span> /home/centos

<span class="c">#Install Chef gem</span>
./ruby/bin/gem install <span class="nt">--no-rdoc</span> <span class="nt">--no-ri</span> chef
</code></pre></div></div>

<p>Please note that I installed ruby with chef to <strong>/home/centos/ruby</strong>, you need to change the path to where you want it to be, the same as chef guys decided <strong>/opt/chef</strong> is the best place for Chef to live. However, we don’t even have access to /opt.</p>

<p>Once you run this piece of code in your VM you will have ruby folder which you can just zip it and deploy to your server. There you go, you just got your customised Chef-solo.</p>

<p>I know it sounds stupid and it’s really hacky and ugly. But here’s what we found out so I want to blog it here so any lucky people might find this useful in the future.</p>


  </div>
</article>

<div class="container mx-auto px-2 py-2 clearfix">
  <!-- Use if you want to show previous and next for all posts. -->



  <div class="col-4 sm-width-full left mr-lg-4 mt-3">
    <a class="no-underline-hover py-1 block" href="http://localhost:4000/how-many-tweets-i-have-tweeted-in-the-past/">
      <span class="h5 bold">Previous</span>
      <p class="bold h3 link-primary mb-1">How many tweets I have tweeted in the past?</p>
      <p>This blog post is kinda lame, but I got so excited to get something worked in R. I have been...</p>
    </a>
  </div>
  
  
  <div class="col-4 sm-width-full left mt-3">
    <a class="no-underline-hover py-1 block" href="http://localhost:4000/paris-2013-food-quest/">
      <span class="h5 bold">Next</span>
      <p class="bold h3 link-primary mb-1">Paris 2013: Food quest.</p>
      <p>I have been asked from my friend if I could take him to Paris and show him around what cafes...</p>
    </a>
  </div>


</div>

    </div>

    <div class="container mx-auto clearfix mt-2 mt-lg-4 px-2">
  <div class="border-top-thick">
    <p class="col-8 sm-width-full left py-2 mb-0">This project is maintained by <a class="text-accent" href="https://github.com/noppanit">noppanit</a></p>
    <ul class="list-reset right clearfix sm-width-full py-2 mb-2 mb-lg-0">
      <li class="inline-block mr-1">
        <a href="https://twitter.com/share" class="twitter-share-button" data-hashtags="Noppanit">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      </li>
      <li class="inline-block">
        <a class="github-button" href="https://github.com/noppanit/" data-icon="octicon-star" data-count-href="noppanit//stargazers" data-count-api="/repos/noppanit/#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star noppanit/ on GitHub">Star</a>
      </li>
    </ul>
  </div>
</div>


  </body>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

</html>