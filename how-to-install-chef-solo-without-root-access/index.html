
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>How to install Chef-Solo without root access? - My Blog</title>
	<meta name="author" content="Noppanit Charassinvichai">

	
	<meta name="description" content="I know the title it&#8217;s stupid. And if you arrived at this post, I know your this question will pop up in your head, &#8220;Why on earth you want &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="My Blog" type="application/atom+xml">
	<link rel="canonical" href=" https://www.noppanit.com/how-to-install-chef-solo-without-root-access/" />
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">My Blog</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/about">About</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/about">About</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:www.noppanit.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/noppanit" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/noppanit" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="https://www.google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:www.noppanit.com">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">How to Install Chef-Solo Without Root Access?</h2>
	<div class="entry-content"><p>I know the title it&#8217;s stupid. And if you arrived at this post, I know your this question will pop up in your head, &#8220;Why on earth you want to do that?&#8221;. Chef is built in the assumption that it has root access and yeah it makes perfect sense. Without root access it&#8217;s like I want to hire a cleaner to clean my house but I want to get my house cleaned without giving my house key to the cleaner. It&#8217;s the same thing here.</p>

<p>However, I&#8217;m here to just talk about how to do this in a very ugly and hacky way.</p>

<p>Problem:<br/>
One day on a client side, they said we want you to deploy the application to our production VM server, but we cannot give you sudo or root access. Of course, it makes sense why would you give some guy root access. The IT guy gives me one folder which you can do anything as long as you stay inside that folder. We won&#8217;t have any problem because our app is basically just a java application with Jetty container, so it doesn&#8217;t matter where it lives. Now, here comes the problem we want to deploy our application anytime we want and we want to do the <a href="http://martinfowler.com/bliki/PhoenixServer.html" title="PhoenixServer">PhoenixServer</a> pattern. But in this case, it&#8217;s just going to be semi phoenixServer, because we&#8217;re not going to wipe the whole box out. So we thought, yeah we could use Chef to provision the server. Great!. But how can you even install Chef without sudo or root access? If you go to Chef and download the Linux version it will be an RPM which obviously it needs root access to install that, which we don&#8217;t have. Hmm, what are we gonna do?</p>

<p>Solution:<br/>
So we thought, well we just need Chef-solo because it&#8217;s just going to be one server. Chef is written in Ruby and our Centos VM doesn&#8217;t even come Ruby. The problem gets bigger, how can we install Ruby without root access. Ha! now here&#8217;s the tricky part. Chef is Ruby, Ruby is C. We have C, so we could compile Ruby and use gem to install Chef. Woohoo! Sounds easy right? By the way, Chef comes with embedded-ruby already that&#8217;s why when you install Chef you don&#8217;t need to install Ruby first. The Chef guys cleverly embedded Ruby inside Chef with all the gems and deploy that to <strong>/opt/chef</strong>. You can find more information <a href="http://www.opscode.com/chef/install/" title="Chef install">here</a>. So, we could do the same thing but we need to compile Ruby and dependencies to our folder. Ok, I&#8217;ll cut to the chest now. All we need is Ruby and Chef gem. In order to install, ruby which I found out you just need three minimum libraries, zlib, yaml and openssl. Here&#8217;s how to do it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#Install Openssl</span>
</span><span class='line'>wget https://www.openssl.org/source/openssl-1.0.0k.tar.gz
</span><span class='line'>tar zxvf openssl-1.0.0k.tar.gz
</span><span class='line'><span class="nb">cd </span>openssl-1.0.0k
</span><span class='line'>./config shared -fPIC --prefix<span class="o">=</span>/home/centos/ruby --openssldir<span class="o">=</span>/home/centos/ruby/ssl
</span><span class='line'>make <span class="o">&amp;&amp;</span> make install
</span><span class='line'><span class="nb">cd</span> /home/centos
</span><span class='line'>
</span><span class='line'><span class="c">#Install zlib</span>
</span><span class='line'>wget http://zlib.net/zlib-1.2.8.tar.gz
</span><span class='line'>tar xzvf zlib-1.2.8.tar.gz
</span><span class='line'><span class="nb">cd </span>zlib-1.2.8
</span><span class='line'>./configure --prefix<span class="o">=</span>/home/centos/ruby
</span><span class='line'>make <span class="o">&amp;&amp;</span> make install
</span><span class='line'><span class="nb">cd</span> /home/centos
</span><span class='line'>
</span><span class='line'><span class="c">#Install Yaml</span>
</span><span class='line'>wget http://pyyaml.org/download/libyaml/yaml-0.1.4.tar.gz
</span><span class='line'>tar xzvf yaml-0.1.4.tar.gz
</span><span class='line'><span class="nb">cd </span>yaml-0.1.4
</span><span class='line'>./configure --disable-install-doc --prefix<span class="o">=</span>/home/centos/ruby
</span><span class='line'>make <span class="o">&amp;&amp;</span> make install
</span><span class='line'><span class="nb">cd</span> /home/centos
</span><span class='line'>
</span><span class='line'><span class="c">#Install Ruby 1.9.3</span>
</span><span class='line'>wget ftp://ftp.ruby-lang.org/pub/ruby/1.9/ruby-1.9.3-p448.tar.gz
</span><span class='line'>tar xzvf ruby-1.9.3-p448.tar.gz
</span><span class='line'><span class="nb">cd </span>ruby-1.9.3-p448
</span><span class='line'>./configure --prefix<span class="o">=</span>/home/centos/ruby --enable-shared --disable-install-doc --with-opt-dir<span class="o">=</span>/home/centos/ruby
</span><span class='line'>make <span class="o">&amp;&amp;</span> make install
</span><span class='line'><span class="nb">cd</span> /home/centos
</span><span class='line'>
</span><span class='line'><span class="c">#Install Chef gem</span>
</span><span class='line'>./ruby/bin/gem install --no-rdoc --no-ri chef
</span></code></pre></td></tr></table></div></figure>


<p>Please note that I installed ruby with chef to <strong>/home/centos/ruby</strong>, you need to change the path to where you want it to be, the same as chef guys decided <strong>/opt/chef</strong> is the best place for Chef to live. However, we don&#8217;t even have access to /opt.</p>

<p>Once you run this piece of code in your VM you will have ruby folder which you can just zip it and deploy to your server. There you go, you just got your customised Chef-solo.</p>

<p>I know it sounds stupid and it&#8217;s really hacky and ugly. But here&#8217;s what we found out so I want to blog it here so any lucky people might find this useful in the future.</p>
</div>


<div class="meta">
	<div class="date">




Aug 23rd, 2013</div>
	<div class="tags">


	<a class='category' href='/blog/categories/knowledges/'>knowledges</a>


</div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		
		<a class="addthis_button_tweet"></a>
		
		
		
	</div>
	
</div>



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    Noppanit Charassinvichai

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'noppanit';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'https://www.noppanit.com/how-to-install-chef-solo-without-root-access/';
        var disqus_url = 'https://www.noppanit.com/how-to-install-chef-solo-without-root-access/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//go.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-11403715-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>